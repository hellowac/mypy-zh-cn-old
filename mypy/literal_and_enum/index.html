
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="hellowac-类型检查">
      
      
      
      
        <link rel="prev" href="../more_types/">
      
      
        <link rel="next" href="../typeddict/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>字面量和枚举 - mypy类型检查</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#字面量和枚举" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
你当前浏览的版本已不是最新版本，
<a href="../../..">
    <strong>点击这里</strong>
</a>查看最新版本的文档

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="mypy类型检查" class="md-header__button md-logo" aria-label="mypy类型检查" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mypy类型检查
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              字面量和枚举
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../" class="md-tabs__link">
          
  
    
  
  第一步

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../builtin_types/" class="md-tabs__link">
          
  
    
  
  类型系统参考

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_conf/" class="md-tabs__link">
          
  
    
  
  配置和运行mypy

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_other/" class="md-tabs__link">
          
  
    
  
  其他杂项

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mypy类型检查" class="md-nav__button md-logo" aria-label="mypy类型检查" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    mypy类型检查
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    第一步
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            第一步
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../cheat_sheet_py3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型提示备忘录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../existing_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    将 mypy 与现有代码库结合使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    类型系统参考
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            类型系统参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../builtin_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内置类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../type_inference_type_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型推断和类型注解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../kind_of_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型种类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../class_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类的基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../annotation_issue_at_runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行时的注解问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../protocol_and_struct_subtyping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    协议及其子类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_typing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../type_narrowing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型收缩
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../duck_type_compatibility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    鸭子类型兼容
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../stub_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存根文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    泛型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../more_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    更多类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    字面量和枚举
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    字面量和枚举
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#字面量类型" class="md-nav__link">
    字面量类型
  </a>
  
    <nav class="md-nav" aria-label="字面量类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参数化字面量" class="md-nav__link">
    参数化字面量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#声明字面量" class="md-nav__link">
    声明字面量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#智能索引" class="md-nav__link">
    智能索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#标记联合类型" class="md-nav__link">
    标记联合类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#详尽性检查" class="md-nav__link">
    详尽性检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#局限性" class="md-nav__link">
    局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#枚举" class="md-nav__link">
    枚举
  </a>
  
    <nav class="md-nav" aria-label="枚举">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#详尽检查" class="md-nav__link">
    详尽检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#额外的枚举检查" class="md-nav__link">
    额外的枚举检查
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../typeddict/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型字典
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../final_names_methods_classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最终名称、方法和类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../metaclasses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    元类
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_conf/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    配置和运行mypy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            配置和运行mypy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/running_mypy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行mypy和管理导入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/command_line.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy命令行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/config_file.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy配置文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/inline_config.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内联配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/mypy_daemon.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy服务(守护进程)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/installed_packages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用安装包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/extending_mypy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扩展和集成 mypy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/stubgen.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/stubtest.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根测试
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_other/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    其他杂项
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            其他杂项
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/common_issues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题及解决办法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/supported_python_features.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    支持的 Python 特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/error_codes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/error_code_list.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    默认启用的错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/error_code_list2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可选检查的错误代码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/additional_features.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    额外特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy.readthedocs.io/en/stable/faq.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题解答
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/python/mypy" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    项目地址
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy-lang.org/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网页地址
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#字面量类型" class="md-nav__link">
    字面量类型
  </a>
  
    <nav class="md-nav" aria-label="字面量类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参数化字面量" class="md-nav__link">
    参数化字面量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#声明字面量" class="md-nav__link">
    声明字面量
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#智能索引" class="md-nav__link">
    智能索引
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#标记联合类型" class="md-nav__link">
    标记联合类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#详尽性检查" class="md-nav__link">
    详尽性检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#局限性" class="md-nav__link">
    局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#枚举" class="md-nav__link">
    枚举
  </a>
  
    <nav class="md-nav" aria-label="枚举">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#详尽检查" class="md-nav__link">
    详尽检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#额外的枚举检查" class="md-nav__link">
    额外的枚举检查
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="字面量和枚举">字面量和枚举<a class="headerlink" href="#字面量和枚举" title="Permanent link">&para;</a></h1>
<p><strong>Literal types and Enums</strong></p>
<h2 id="字面量类型">字面量类型<a class="headerlink" href="#字面量类型" title="Permanent link">&para;</a></h2>
<p>Literal types</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>字面量类型可让您指示表达式等于某个特定的原始值。 例如，如果我们用 <code>Literal["foo"]</code> 类型注释一个变量，mypy 将理解该变量不仅是 <code>str</code> 类型，而且还等于字符串 <code>"foo"</code>。</p>
<p>当注释根据调用者提供的确切值而表现不同的函数时，此功能主要有用。 例如，假设我们有一个函数“fetch_data(...)”，如果第一个参数为“True”，则返回 “bytes” ；如果第一个参数为“False”，则返回“str”。 我们可以使用“Literal[...]”和重载为此函数构造精确的类型签名：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union, Literal

<span style="color: #3D7B7B; font-style: italic"># 前两个重载使用 Literal[...]，因此我们可以获得精确的返回类型：</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: Literal[<span style="color: #008000; font-weight: bold">True</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bytes</span>: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: Literal[<span style="color: #008000; font-weight: bold">False</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #3D7B7B; font-style: italic"># 最后一个重载是调用者提供常规布尔值时的后备：</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">bytes</span>, <span style="color: #008000">str</span>]: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">bytes</span>, <span style="color: #008000">str</span>]:
    <span style="color: #3D7B7B; font-style: italic"># 省略实现</span>
    <span style="color: #666666">...</span>

reveal_type(fetch_data(<span style="color: #008000; font-weight: bold">True</span>))        <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;bytes&quot;</span>
reveal_type(fetch_data(<span style="color: #008000; font-weight: bold">False</span>))       <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 没有注释声明的变量将继续具有“bool”的推断类型。</span>

variable <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">True</span>
reveal_type(fetch_data(variable))    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Union[bytes, str]&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>本页中的示例从“typing”模块导入“Literal”以及“Final”和“TypedDict”。 这些类型已添加到 Python 3.8 中的“typing”中，但也可以通过“typing_extensions”包在 Python 3.4 - 3.7 中使用。</p>
</div>
</div>
<div class="tabbed-block">
<p>Literal types let you indicate that an expression is equal to some specific primitive value. For example, if we annotate a variable with type <code>Literal["foo"]</code>, mypy will understand that variable is not only of type <code>str</code>, but is also equal to specifically the string <code>"foo"</code>.</p>
<p>This feature is primarily useful when annotating functions that behave differently based on the exact value the caller provides. For example, suppose we have a function <code>fetch_data(...)</code> that returns <code>bytes</code> if the first argument is <code>True</code>, and <code>str</code> if it's <code>False</code>. We can construct a precise type signature for this function using <code>Literal[...]</code> and overloads:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union, Literal

<span style="color: #3D7B7B; font-style: italic"># The first two overloads use Literal[...] so we can</span>
<span style="color: #3D7B7B; font-style: italic"># have precise return types:</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: Literal[<span style="color: #008000; font-weight: bold">True</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bytes</span>: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: Literal[<span style="color: #008000; font-weight: bold">False</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #3D7B7B; font-style: italic"># The last overload is a fallback in case the caller</span>
<span style="color: #3D7B7B; font-style: italic"># provides a regular bool:</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">bytes</span>, <span style="color: #008000">str</span>]: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">fetch_data</span>(raw: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">bytes</span>, <span style="color: #008000">str</span>]:
    <span style="color: #3D7B7B; font-style: italic"># Implementation is omitted</span>
    <span style="color: #666666">...</span>

reveal_type(fetch_data(<span style="color: #008000; font-weight: bold">True</span>))        <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;bytes&quot;</span>
reveal_type(fetch_data(<span style="color: #008000; font-weight: bold">False</span>))       <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># Variables declared without annotations will continue to have an</span>
<span style="color: #3D7B7B; font-style: italic"># inferred type of &#39;bool&#39;.</span>

variable <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">True</span>
reveal_type(fetch_data(variable))    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Union[bytes, str]&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>The examples in this page import <code>Literal</code> as well as <code>Final</code> and <code>TypedDict</code> from the <code>typing</code> module. These types were added to <code>typing</code> in Python 3.8, but are also available for use in Python 3.4 - 3.7 via the <code>typing_extensions</code> package.</p>
</div>
</div>
</div>
</div>
<h3 id="参数化字面量">参数化字面量<a class="headerlink" href="#参数化字面量" title="Permanent link">&para;</a></h3>
<p>Parameterizing Literals</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>字面量类型可以包含一个或多个文字 bool、int、str、byte 和 enum 值。 但是，字面量类型<strong>不能</strong>包含任意表达式：诸如“Literal[my_string.trim()]”、“Literal[x &gt; 3]”或“Literal[3j + 4]”之类的类型都是非法的。</p>
<p>包含两个或多个值的文字相当于这些值的并集。 因此， <code>Literal[-3, b"foo", MyEnum.A]</code> 相当于 <code>Union[Literal[-3], Literal[b] “foo”]，</code>Literal[[MyEnum.A]]`。 这使得编写涉及文字的更复杂的类型变得更加方便。</p>
<p>字面量类型也可能包含“None”。 Mypy 会将 <code>Literal[None]</code> 视为等同于 <code>None</code>。 这意味着 <code>Literal[4, None]</code>、<code>Union[Literal[4], None]</code> 和 <code>Optional[Literal[4]]</code> 都是等价的。</p>
<p>文字还可以包含其他字面量类型的别名。 例如，以下程序是合法的：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PrimaryColors <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&quot;red&quot;</span>, <span style="color: #BA2121">&quot;blue&quot;</span>, <span style="color: #BA2121">&quot;yellow&quot;</span>]
SecondaryColors <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&quot;purple&quot;</span>, <span style="color: #BA2121">&quot;green&quot;</span>, <span style="color: #BA2121">&quot;orange&quot;</span>]
AllowedColors <span style="color: #666666">=</span> Literal[PrimaryColors, SecondaryColors]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">paint</span>(color: AllowedColors) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #666666">...</span>

paint(<span style="color: #BA2121">&quot;red&quot;</span>)        <span style="color: #3D7B7B; font-style: italic"># Type checks!</span>
paint(<span style="color: #BA2121">&quot;turquoise&quot;</span>)  <span style="color: #3D7B7B; font-style: italic"># Does not type check</span>
</code></pre></div>
<p>字面量不能包含任何其他类型或表达式。 这意味着执行 <code>Literal[my_instance]</code>、<code>Literal[Any]</code>、<code>Literal[3.14]</code> 或 <code>Literal[{"foo": 2, "bar": 5}]</code> 都是非法的。</p>
</div>
<div class="tabbed-block">
<p>Literal types may contain one or more literal bools, ints, strs, bytes, and enum values. However, literal types <strong>cannot</strong> contain arbitrary expressions: types like <code>Literal[my_string.trim()]</code>, <code>Literal[x &gt; 3]</code>, or <code>Literal[3j + 4]</code> are all illegal.</p>
<p>Literals containing two or more values are equivalent to the union of those values.= So, <code>Literal[-3, b"foo", MyEnum.A]</code> is equivalent to= <code>Union[Literal[-3], Literal[b"foo"], Literal[MyEnum.A]]</code>. This makes writing more= complex types involving literals a little more convenient.</p>
<p>Literal types may also contain <code>None</code>. Mypy will treat <code>Literal[None]</code> as being equivalent to just <code>None</code>. This means that <code>Literal[4, None]</code>, <code>Union[Literal[4], None]</code>, and <code>Optional[Literal[4]]</code> are all equivalent.</p>
<p>Literals may also contain aliases to other literal types. For example, the following program is legal:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PrimaryColors <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&quot;red&quot;</span>, <span style="color: #BA2121">&quot;blue&quot;</span>, <span style="color: #BA2121">&quot;yellow&quot;</span>]
SecondaryColors <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&quot;purple&quot;</span>, <span style="color: #BA2121">&quot;green&quot;</span>, <span style="color: #BA2121">&quot;orange&quot;</span>]
AllowedColors <span style="color: #666666">=</span> Literal[PrimaryColors, SecondaryColors]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">paint</span>(color: AllowedColors) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #666666">...</span>

paint(<span style="color: #BA2121">&quot;red&quot;</span>)        <span style="color: #3D7B7B; font-style: italic"># Type checks!</span>
paint(<span style="color: #BA2121">&quot;turquoise&quot;</span>)  <span style="color: #3D7B7B; font-style: italic"># Does not type check</span>
</code></pre></div>
<p>Literals may not contain any other kind of type or expression. This means doing <code>Literal[my_instance]</code>, <code>Literal[Any]</code>, <code>Literal[3.14]</code>, or <code>Literal[{"foo": 2, "bar": 5}]</code> are all illegal.</p>
</div>
</div>
</div>
<h3 id="声明字面量">声明字面量<a class="headerlink" href="#声明字面量" title="Permanent link">&para;</a></h3>
<p>Declaring literal variables</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>您必须显式向变量添加注释以声明它具有字面量类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>a: Literal[<span style="color: #666666">19</span>] <span style="color: #666666">=</span> <span style="color: #666666">19</span>
reveal_type(a)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[19]&quot;</span>
</code></pre></div>
<p>为了保持向后兼容性，没有此注解的变量<strong>不</strong>假定为字面量：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>b <span style="color: #666666">=</span> <span style="color: #666666">19</span>
reveal_type(b)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;int&quot;</span>
</code></pre></div>
<p>如果您发现在类型提示中重复变量的值很乏味，您可以将变量更改为“Final”（请参阅<a href="https://mypy.readthedocs.io/en/stable/final_attrs.html#final-attrs">“final_attrs”</a>）：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">expects_literal</span>(x: Literal[<span style="color: #666666">19</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #008000; font-weight: bold">pass</span>

c: Final <span style="color: #666666">=</span> <span style="color: #666666">19</span>

reveal_type(c)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[19]?&quot;</span>
expects_literal(c)      <span style="color: #3D7B7B; font-style: italic"># ...and this type checks!</span>
</code></pre></div>
<p>如果您没有在 “Final” 中提供显式类型，则 “c” 的类型将变为<em>上下文相关</em>：在执行类型检查之前，只要使用原始分配的值，mypy 基本上都会尝试“替换”原始分配的值。 这就是为什么 <code>c</code> 的显示类型是 <code>Literal[19]?</code>：末尾的问号反映了这种上下文相关的性质。</p>
<p>例如，mypy 将对上述程序进行类型检查，几乎就像这样编写的：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">expects_literal</span>(x: Literal[<span style="color: #666666">19</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #008000; font-weight: bold">pass</span>

reveal_type(<span style="color: #666666">19</span>)
expects_literal(<span style="color: #666666">19</span>)
</code></pre></div>
<p>这意味着虽然将变量更改为“Final”与添加显式“Literal[...]”注释并不完全相同，但在实践中通常会产生相同的效果。</p>
<p>上下文相关类型与真实字面量类型的行为不同的主要情况是当您尝试在未明确期望“Literal[...]”的地方使用这些类型时。 例如，比较和对比当您尝试将这些类型附加到列表时会发生什么：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

a: Final <span style="color: #666666">=</span> <span style="color: #666666">19</span>
b: Literal[<span style="color: #666666">19</span>] <span style="color: #666666">=</span> <span style="color: #666666">19</span>

<span style="color: #3D7B7B; font-style: italic"># Mypy 会选择在这里推断 list[int]。</span>
list_of_ints <span style="color: #666666">=</span> []
list_of_ints<span style="color: #666666">.</span>append(a)
reveal_type(list_of_ints)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;list[int]&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 但是，如果您要附加的变量是显式文字，则 mypy 将推断 list[Literal[19]]。</span>
list_of_lits <span style="color: #666666">=</span> []
list_of_lits<span style="color: #666666">.</span>append(b)
reveal_type(list_of_lits)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;list[Literal[19]]&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You must explicitly add an annotation to a variable to declare that it has a literal type:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>a: Literal[<span style="color: #666666">19</span>] <span style="color: #666666">=</span> <span style="color: #666666">19</span>
reveal_type(a)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[19]&quot;</span>
</code></pre></div>
<p>In order to preserve backwards-compatibility, variables without this annotation are <strong>not</strong> assumed to be literals:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>b <span style="color: #666666">=</span> <span style="color: #666666">19</span>
reveal_type(b)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;int&quot;</span>
</code></pre></div>
<p>If you find repeating the value of the variable in the type hint to be tedious, you can instead change the variable to be <code>Final</code> (see <a href="https://mypy.readthedocs.io/en/stable/final_attrs.html#final-attrs"><code>final_attrs</code></a>):</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">expects_literal</span>(x: Literal[<span style="color: #666666">19</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #008000; font-weight: bold">pass</span>

c: Final <span style="color: #666666">=</span> <span style="color: #666666">19</span>

reveal_type(c)          <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[19]?&quot;</span>
expects_literal(c)      <span style="color: #3D7B7B; font-style: italic"># ...and this type checks!</span>
</code></pre></div>
<p>If you do not provide an explicit type in the <code>Final</code>, the type of <code>c</code> becomes <em>context-sensitive</em>: mypy will basically try "substituting" the original assigned value whenever it's used before performing type checking. This is why the revealed type of <code>c</code> is <code>Literal[19]?</code>: the question mark at the end reflects this context-sensitive nature.</p>
<p>For example, mypy will type check the above program almost as if it were written like so:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">expects_literal</span>(x: Literal[<span style="color: #666666">19</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #008000; font-weight: bold">pass</span>

reveal_type(<span style="color: #666666">19</span>)
expects_literal(<span style="color: #666666">19</span>)
</code></pre></div>
<p>This means that while changing a variable to be <code>Final</code> is not quite the same thing as adding an explicit <code>Literal[...]</code> annotation, it often leads to the same effect in practice.</p>
<p>The main cases where the behavior of context-sensitive vs true literal types differ are when you try using those types in places that are not explicitly expecting a <code>Literal[...]</code>. For example, compare and contrast what happens when you try appending these types to a list:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Final, Literal

a: Final <span style="color: #666666">=</span> <span style="color: #666666">19</span>
b: Literal[<span style="color: #666666">19</span>] <span style="color: #666666">=</span> <span style="color: #666666">19</span>

<span style="color: #3D7B7B; font-style: italic"># Mypy will choose to infer list[int] here.</span>
list_of_ints <span style="color: #666666">=</span> []
list_of_ints<span style="color: #666666">.</span>append(a)
reveal_type(list_of_ints)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;list[int]&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># But if the variable you&#39;re appending is an explicit Literal, mypy</span>
<span style="color: #3D7B7B; font-style: italic"># will infer list[Literal[19]].</span>
list_of_lits <span style="color: #666666">=</span> []
list_of_lits<span style="color: #666666">.</span>append(b)
reveal_type(list_of_lits)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;list[Literal[19]]&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="智能索引">智能索引<a class="headerlink" href="#智能索引" title="Permanent link">&para;</a></h3>
<p>Intelligent indexing</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>我们可以使用 Literal 类型更精确地索引到结构化异构类型，例如元组、NamedTuples 和 TypedDicts。 此功能称为“智能索引”。</p>
<p>例如，当我们使用某些 int 索引元组时，推断的类型通常是元组项类型的并集。 但是，如果我们只想要与某个特定索引相对应的类型，我们可以使用字面量类型，如下所示：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypedDict

tup <span style="color: #666666">=</span> (<span style="color: #BA2121">&quot;foo&quot;</span>, <span style="color: #666666">3.4</span>)

<span style="color: #3D7B7B; font-style: italic"># 使用 int 文字进行索引可以为我们提供该索引的确切类型</span>
reveal_type(tup[<span style="color: #666666">0</span>])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 但是如果我们希望索引是一个变量怎么办？ 通常 mypy 不会确切知道索引是什么，因此会返回不太精确的类型：</span>
int_index <span style="color: #666666">=</span> <span style="color: #666666">0</span>
reveal_type(tup[int_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Union[str, float]&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 但是如果我们使用 Literal 类型或 Final int，我们就可以恢复原来的精度：</span>
lit_index: Literal[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
fin_index: Final <span style="color: #666666">=</span> <span style="color: #666666">0</span>
reveal_type(tup[lit_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>
reveal_type(tup[fin_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 我们可以使用 TypedDict 和 str 键做同样的事情：</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyDict</span>(TypedDict):
    name: <span style="color: #008000">str</span>
    main_id: <span style="color: #008000">int</span>
    backup_id: <span style="color: #008000">int</span>

d: MyDict <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;name&quot;</span>: <span style="color: #BA2121">&quot;Saanvi&quot;</span>, <span style="color: #BA2121">&quot;main_id&quot;</span>: <span style="color: #666666">111</span>, <span style="color: #BA2121">&quot;backup_id&quot;</span>: <span style="color: #666666">222</span>}
name_key: Final <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;name&quot;</span>
reveal_type(d[name_key])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># 您还可以使用字面量联合进行索引</span>
id_key: Literal[<span style="color: #BA2121">&quot;main_id&quot;</span>, <span style="color: #BA2121">&quot;backup_id&quot;</span>]
reveal_type(d[id_key])    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;int&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We can use Literal types to more precisely index into structured heterogeneous types such as tuples, NamedTuples, and TypedDicts. This feature is known as <em>intelligent indexing</em>.</p>
<p>For example, when we index into a tuple using some int, the inferred type is normally the union of the tuple item types. However, if we want just the type corresponding to some particular index, we can use Literal types like so:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypedDict

tup <span style="color: #666666">=</span> (<span style="color: #BA2121">&quot;foo&quot;</span>, <span style="color: #666666">3.4</span>)

<span style="color: #3D7B7B; font-style: italic"># Indexing with an int literal gives us the exact type for that index</span>
reveal_type(tup[<span style="color: #666666">0</span>])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># But what if we want the index to be a variable? Normally mypy won&#39;t</span>
<span style="color: #3D7B7B; font-style: italic"># know exactly what the index is and so will return a less precise type:</span>
int_index <span style="color: #666666">=</span> <span style="color: #666666">0</span>
reveal_type(tup[int_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Union[str, float]&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># But if we use either Literal types or a Final int, we can gain back</span>
<span style="color: #3D7B7B; font-style: italic"># the precision we originally had:</span>
lit_index: Literal[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0</span>
fin_index: Final <span style="color: #666666">=</span> <span style="color: #666666">0</span>
reveal_type(tup[lit_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>
reveal_type(tup[fin_index])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># We can do the same thing with with TypedDict and str keys:</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyDict</span>(TypedDict):
    name: <span style="color: #008000">str</span>
    main_id: <span style="color: #008000">int</span>
    backup_id: <span style="color: #008000">int</span>

d: MyDict <span style="color: #666666">=</span> {<span style="color: #BA2121">&quot;name&quot;</span>: <span style="color: #BA2121">&quot;Saanvi&quot;</span>, <span style="color: #BA2121">&quot;main_id&quot;</span>: <span style="color: #666666">111</span>, <span style="color: #BA2121">&quot;backup_id&quot;</span>: <span style="color: #666666">222</span>}
name_key: Final <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;name&quot;</span>
reveal_type(d[name_key])  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;str&quot;</span>

<span style="color: #3D7B7B; font-style: italic"># You can also index using unions of literals</span>
id_key: Literal[<span style="color: #BA2121">&quot;main_id&quot;</span>, <span style="color: #BA2121">&quot;backup_id&quot;</span>]
reveal_type(d[id_key])    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;int&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="标记联合类型">标记联合类型<a class="headerlink" href="#标记联合类型" title="Permanent link">&para;</a></h3>
<p>Tagged unions</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">中文</label><label for="__tabbed_5_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>当您有类型的联合时，通常可以使用“isinstance”检查来区分联合中的每种类型。 例如，如果您有一个类型为“Union[int, str]”的变量“x”，您可以通过执行“if isinstance(x, int): ..”来编写一些仅当“x”是 int 时才运行的代码。 .`.</p>
<p>然而，这样做并不总是可能或方便。 例如，不可能使用“isinstance”来区分两个不同的 TypedDict，因为在运行时，您的变量只是一个字典。</p>
<p>相反，您可以做的是使用不同的文字类型<em>标签</em>或<em>标记</em>您的 TypedDicts。 然后，您可以通过检查标签来区分每种 TypedDict：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal, TypedDict, Union

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">NewJobEvent</span>(TypedDict):
    tag: Literal[<span style="color: #BA2121">&quot;new-job&quot;</span>]
    job_name: <span style="color: #008000">str</span>
    config_file_path: <span style="color: #008000">str</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CancelJobEvent</span>(TypedDict):
    tag: Literal[<span style="color: #BA2121">&quot;cancel-job&quot;</span>]
    job_id: <span style="color: #008000">int</span>

Event <span style="color: #666666">=</span> Union[NewJobEvent, CancelJobEvent]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">process_event</span>(event: Event) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #3D7B7B; font-style: italic"># 由于我们确保两个 TypedDict 都有一个名为“tag”的键，因此执行“event[“tag”]”是安全的。 </span>
    <span style="color: #3D7B7B; font-style: italic"># 该表达式通常具有 Literal[&quot;new-job&quot;, &quot;cancel-job&quot;] 类型，</span>
    <span style="color: #3D7B7B; font-style: italic"># 但下面的检查会将类型范围缩小为 Literal[&quot;new-job&quot;] 或 Literal[&quot;cancel-job&quot;]。</span>
    <span style="color: #3D7B7B; font-style: italic">#</span>
    <span style="color: #3D7B7B; font-style: italic"># 这又将“event”的类型缩小为 NewJobEvent 或 CancelJobEvent。</span>
    <span style="color: #008000; font-weight: bold">if</span> event[<span style="color: #BA2121">&quot;tag&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;new-job&quot;</span>:
        <span style="color: #008000">print</span>(event[<span style="color: #BA2121">&quot;job_name&quot;</span>])
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000">print</span>(event[<span style="color: #BA2121">&quot;job_id&quot;</span>])
</code></pre></div>
<p>虽然此功能在使用 TypedDicts 时非常有用，但您也可以对常规对象、元组或命名元组使用相同的技术。</p>
<p>类似地，标签不需要是专门的 str 文字：它们可以是您通常可以在“if”语句等中缩小范围的任何类型。 
例如，您可以将标签设置为 int 或 Enum Literals，甚至可以使用“isinstance()”缩小常规类：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Generic, TypeVar, Union

T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Wrapper</span>(Generic[T]):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, inner: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>inner <span style="color: #666666">=</span> inner

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">process</span>(w: Union[Wrapper[<span style="color: #008000">int</span>], Wrapper[<span style="color: #008000">str</span>]]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #3D7B7B; font-style: italic"># 执行“if isinstance(w, Wrapper[int])”不起作用：isinstance 要求第二个参数始终是*已删除的*类型，没有泛型。 这是因为泛型是一个仅输入的概念，并且在运行时不以“isinstance”始终可以检查的方式存在。</span>
    <span style="color: #3D7B7B; font-style: italic">#</span>
    <span style="color: #3D7B7B; font-style: italic"># 然而，我们可以通过检查“w.inner”的类型来缩小“w”本身来回避这个问题：</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(w<span style="color: #666666">.</span>inner, <span style="color: #008000">int</span>):
        reveal_type(w)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Wrapper[int]&quot;</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        reveal_type(w)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Wrapper[str]&quot;</span>
</code></pre></div>
<p>在其他编程语言中，此功能有时称为“求和类型”或“可区分联合类型”。</p>
</div>
<div class="tabbed-block">
<p>When you have a union of types, you can normally discriminate between each type in the union by using <code>isinstance</code> checks. For example, if you had a variable <code>x</code> of type <code>Union[int, str]</code>, you could write some code that runs only if <code>x</code> is an int by doing <code>if isinstance(x, int): ...</code>.</p>
<p>However, it is not always possible or convenient to do this. For example, it is not possible to use <code>isinstance</code> to distinguish between two different TypedDicts since at runtime, your variable will simply be just a dict.</p>
<p>Instead, what you can do is <em>label</em> or <em>tag</em> your TypedDicts with a distinct Literal type. Then, you can discriminate between each kind of TypedDict by checking the label:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal, TypedDict, Union

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">NewJobEvent</span>(TypedDict):
    tag: Literal[<span style="color: #BA2121">&quot;new-job&quot;</span>]
    job_name: <span style="color: #008000">str</span>
    config_file_path: <span style="color: #008000">str</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">CancelJobEvent</span>(TypedDict):
    tag: Literal[<span style="color: #BA2121">&quot;cancel-job&quot;</span>]
    job_id: <span style="color: #008000">int</span>

Event <span style="color: #666666">=</span> Union[NewJobEvent, CancelJobEvent]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">process_event</span>(event: Event) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #3D7B7B; font-style: italic"># Since we made sure both TypedDicts have a key named &#39;tag&#39;, it&#39;s</span>
    <span style="color: #3D7B7B; font-style: italic"># safe to do &#39;event[&quot;tag&quot;]&#39;. This expression normally has the type</span>
    <span style="color: #3D7B7B; font-style: italic"># Literal[&quot;new-job&quot;, &quot;cancel-job&quot;], but the check below will narrow</span>
    <span style="color: #3D7B7B; font-style: italic"># the type to either Literal[&quot;new-job&quot;] or Literal[&quot;cancel-job&quot;].</span>
    <span style="color: #3D7B7B; font-style: italic">#</span>
    <span style="color: #3D7B7B; font-style: italic"># This in turns narrows the type of &#39;event&#39; to either NewJobEvent</span>
    <span style="color: #3D7B7B; font-style: italic"># or CancelJobEvent.</span>
    <span style="color: #008000; font-weight: bold">if</span> event[<span style="color: #BA2121">&quot;tag&quot;</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&quot;new-job&quot;</span>:
        <span style="color: #008000">print</span>(event[<span style="color: #BA2121">&quot;job_name&quot;</span>])
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000">print</span>(event[<span style="color: #BA2121">&quot;job_id&quot;</span>])
</code></pre></div>
<p>While this feature is mostly useful when working with TypedDicts, you can also use the same technique with regular objects, tuples, or namedtuples.</p>
<p>Similarly, tags do not need to be specifically str Literals: they can be any type you can normally narrow within <code>if</code> statements and the like. For example, you could have your tags be int or Enum Literals or even regular classes you narrow using <code>isinstance()</code>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Generic, TypeVar, Union

T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Wrapper</span>(Generic[T]):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, inner: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>inner <span style="color: #666666">=</span> inner

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">process</span>(w: Union[Wrapper[<span style="color: #008000">int</span>], Wrapper[<span style="color: #008000">str</span>]]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #3D7B7B; font-style: italic"># Doing `if isinstance(w, Wrapper[int])` does not work: isinstance requires</span>
    <span style="color: #3D7B7B; font-style: italic"># that the second argument always be an *erased* type, with no generics.</span>
    <span style="color: #3D7B7B; font-style: italic"># This is because generics are a typing-only concept and do not exist at</span>
    <span style="color: #3D7B7B; font-style: italic"># runtime in a way `isinstance` can always check.</span>
    <span style="color: #3D7B7B; font-style: italic">#</span>
    <span style="color: #3D7B7B; font-style: italic"># However, we can side-step this by checking the type of `w.inner` to</span>
    <span style="color: #3D7B7B; font-style: italic"># narrow `w` itself:</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(w<span style="color: #666666">.</span>inner, <span style="color: #008000">int</span>):
        reveal_type(w)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Wrapper[int]&quot;</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        reveal_type(w)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Wrapper[str]&quot;</span>
</code></pre></div>
<p>This feature is sometimes called "sum types" or "discriminated union types" in other programming languages.</p>
</div>
</div>
</div>
<h3 id="详尽性检查">详尽性检查<a class="headerlink" href="#详尽性检查" title="Permanent link">&para;</a></h3>
<p>Exhaustiveness checking</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">中文</label><label for="__tabbed_6_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>您可能想要检查某些代码是否涵盖了所有可能的“Literal”或“Enum”情况。 例子：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal

PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(<span style="color: #BA2121">f&#39;Invalid value: </span><span style="color: #A45A77; font-weight: bold">{</span>x<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>)

<span style="color: #008000; font-weight: bold">assert</span> validate(<span style="color: #BA2121">&#39;one&#39;</span>) <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">True</span>
<span style="color: #008000; font-weight: bold">assert</span> validate(<span style="color: #BA2121">&#39;two&#39;</span>) <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">False</span>
</code></pre></div>
<p>上面的代码很容易出错。 您可以向“PossibleValues”添加一个新的文字值，但忘记在“validate”函数中处理它：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]
</code></pre></div>
<p>Mypy 不会发现“three”未被覆盖。 如果您希望 mypy 执行详尽检查，则需要更新代码以使用 <code>assert_never()</code> 检查：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal, NoReturn

PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">assert_never</span>(value: NoReturn) <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #3D7B7B; font-style: italic"># 这在运行时也有效</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000; font-weight: bold">False</span>, <span style="color: #BA2121">f&#39;This code should never be reached, got: </span><span style="color: #A45A77; font-weight: bold">{</span>value<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    assert_never(x)
</code></pre></div>
<p>现在，如果您向“PossibleValues”添加新值但不更新“validate”，mypy 将发现错误：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    <span style="color: #3D7B7B; font-style: italic"># Error: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Literal[&#39;three&#39;]&quot;;</span>
    <span style="color: #3D7B7B; font-style: italic"># expected &quot;NoReturn&quot;</span>
    assert_never(x)
</code></pre></div>
<p>如果不需要运行时检查意外值，则可以省略上面示例中的“assert_never”调用，并且 mypy 仍会生成有关函数“validate”返回无值的错误：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]

<span style="color: #3D7B7B; font-style: italic"># Error: Missing return statement</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
</code></pre></div>
<p>匹配语句也支持详尽检查（Python 3.10 及更高版本）：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">match</span> x:
        <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;one&#39;</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
        <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;two&#39;</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    assert_never(x)
</code></pre></div>
</div>
<div class="tabbed-block">
<p>You may want to check that some code covers all possible <code>Literal</code> or <code>Enum</code> cases. Example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal

PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">ValueError</span>(<span style="color: #BA2121">f&#39;Invalid value: </span><span style="color: #A45A77; font-weight: bold">{</span>x<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>)

<span style="color: #008000; font-weight: bold">assert</span> validate(<span style="color: #BA2121">&#39;one&#39;</span>) <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">True</span>
<span style="color: #008000; font-weight: bold">assert</span> validate(<span style="color: #BA2121">&#39;two&#39;</span>) <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">False</span>
</code></pre></div>
<p>In the code above, it's easy to make a mistake. You can add a new literal value to <code>PossibleValues</code> but forget to handle it in the <code>validate</code> function:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]
</code></pre></div>
<p>Mypy won't catch that <code>'three'</code> is not covered.  If you want mypy to perform an exhaustiveness check, you need to update your code to use an <code>assert_never()</code> check:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Literal, NoReturn

PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">assert_never</span>(value: NoReturn) <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #3D7B7B; font-style: italic"># This also works at runtime as well</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000; font-weight: bold">False</span>, <span style="color: #BA2121">f&#39;This code should never be reached, got: </span><span style="color: #A45A77; font-weight: bold">{</span>value<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    assert_never(x)
</code></pre></div>
<p>Now if you add a new value to <code>PossibleValues</code> but don't update <code>validate</code>, mypy will spot the error:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    <span style="color: #3D7B7B; font-style: italic"># Error: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Literal[&#39;three&#39;]&quot;;</span>
    <span style="color: #3D7B7B; font-style: italic"># expected &quot;NoReturn&quot;</span>
    assert_never(x)
</code></pre></div>
<p>If runtime checking against unexpected values is not needed, you can leave out the <code>assert_never</code> call in the above example, and mypy will still generate an error about function <code>validate</code> returning without a value:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>PossibleValues <span style="color: #666666">=</span> Literal[<span style="color: #BA2121">&#39;one&#39;</span>, <span style="color: #BA2121">&#39;two&#39;</span>, <span style="color: #BA2121">&#39;three&#39;</span>]

<span style="color: #3D7B7B; font-style: italic"># Error: Missing return statement</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;one&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
    <span style="color: #008000; font-weight: bold">elif</span> x <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;two&#39;</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
</code></pre></div>
<p>Exhaustiveness checking is also supported for match statements (Python 3.10 and later):</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">validate</span>(x: PossibleValues) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
    <span style="color: #008000; font-weight: bold">match</span> x:
        <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;one&#39;</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
        <span style="color: #008000; font-weight: bold">case</span> <span style="color: #BA2121">&#39;two&#39;</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">False</span>
    assert_never(x)
</code></pre></div>
</div>
</div>
</div>
<h3 id="局限性">局限性<a class="headerlink" href="#局限性" title="Permanent link">&para;</a></h3>
<p>Limitations</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">中文</label><label for="__tabbed_7_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 无法深入理解使用“Literal[..]”类型变量的表达式。 例如，如果您有一个类型为“Literal[3]”的变量“a”和另一个类型为“Literal[5]”的变量“b”，mypy 将推断“a + b”的类型为“int”，<em> </em>不是** 输入 <code>Literal[8]</code>。</p>
<p>基本规则是文字类型被视为参数具有的任何类型的常规子类型。 例如，“Literal[3]”被视为“int”的子类型，因此将直接继承“int”的所有方法。 这意味着 <code>Literal[3].__add__</code> 接受与 <code>int.__add__</code> 相同的参数并具有相同的返回类型。</p>
</div>
<div class="tabbed-block">
<p>Mypy will not understand expressions that use variables of type <code>Literal[..]</code> on a deep level. For example, if you have a variable <code>a</code> of type <code>Literal[3]</code> and another variable <code>b</code> of type <code>Literal[5]</code>, mypy will infer that <code>a + b</code> has type <code>int</code>, <strong>not</strong> type <code>Literal[8]</code>.</p>
<p>The basic rule is that literal types are treated as just regular subtypes of whatever type the parameter has. For example, <code>Literal[3]</code> is treated as a subtype of <code>int</code> and so will inherit all of <code>int</code>'s methods directly. This means that <code>Literal[3].__add__</code> accepts the same arguments and has the same return type as <code>int.__add__</code>.</p>
</div>
</div>
</div>
<h2 id="枚举">枚举<a class="headerlink" href="#枚举" title="Permanent link">&para;</a></h2>
<p>Enums</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">中文</label><label for="__tabbed_8_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 对 <a href="https://docs.python.org/3/library/enum.html#enum.Enum"><code>enum.Enum</code></a> 及其子类有特殊支持: <a href="https://docs.python.org/3/library/enum.html#enum.IntEnum"><code>enum.IntEnum</code></a>, <a href="https://docs.python.org/3/library/enum.html#enum.Flag"><code>enum.Flag</code></a>, <a href="https://docs.python.org/3/library/enum.html#enum.IntFlag"><code>enum.IntFlag</code></a>, and <a href="https://docs.python.org/3/library/enum.html#enum.StrEnum"><code>enum.StrEnum</code></a>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">enum</span> <span style="color: #008000; font-weight: bold">import</span> Enum

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Direction</span>(Enum):
    up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;up&#39;</span>
    down <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;down&#39;</span>

reveal_type(Direction<span style="color: #666666">.</span>up)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[Direction.up]?&quot;</span>
reveal_type(Direction<span style="color: #666666">.</span>down)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[Direction.down]?&quot;</span>
</code></pre></div>
<p>You can use enums to annotate types as you would expect:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Movement</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, direction: Direction, speed: <span style="color: #008000">float</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>direction <span style="color: #666666">=</span> direction
        <span style="color: #008000">self</span><span style="color: #666666">.</span>speed <span style="color: #666666">=</span> speed

Movement(Direction<span style="color: #666666">.</span>up, <span style="color: #666666">5.0</span>)  <span style="color: #3D7B7B; font-style: italic"># ok</span>
Movement(<span style="color: #BA2121">&#39;up&#39;</span>, <span style="color: #666666">5.0</span>)  <span style="color: #3D7B7B; font-style: italic"># E: Argument 1 to &quot;Movement&quot; has incompatible type &quot;str&quot;; expected &quot;Direction&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy has special support for <a href="https://docs.python.org/3/library/enum.html#enum.Enum"><code>enum.Enum</code></a> and its subclasses: <a href="https://docs.python.org/3/library/enum.html#enum.IntEnum"><code>enum.IntEnum</code></a>, <a href="https://docs.python.org/3/library/enum.html#enum.Flag"><code>enum.Flag</code></a>, <a href="https://docs.python.org/3/library/enum.html#enum.IntFlag"><code>enum.IntFlag</code></a>, and <a href="https://docs.python.org/3/library/enum.html#enum.StrEnum"><code>enum.StrEnum</code></a>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">enum</span> <span style="color: #008000; font-weight: bold">import</span> Enum

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Direction</span>(Enum):
    up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;up&#39;</span>
    down <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;down&#39;</span>

reveal_type(Direction<span style="color: #666666">.</span>up)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[Direction.up]?&quot;</span>
reveal_type(Direction<span style="color: #666666">.</span>down)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Literal[Direction.down]?&quot;</span>
</code></pre></div>
<p>You can use enums to annotate types as you would expect:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Movement</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, direction: Direction, speed: <span style="color: #008000">float</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>direction <span style="color: #666666">=</span> direction
        <span style="color: #008000">self</span><span style="color: #666666">.</span>speed <span style="color: #666666">=</span> speed

Movement(Direction<span style="color: #666666">.</span>up, <span style="color: #666666">5.0</span>)  <span style="color: #3D7B7B; font-style: italic"># ok</span>
Movement(<span style="color: #BA2121">&#39;up&#39;</span>, <span style="color: #666666">5.0</span>)  <span style="color: #3D7B7B; font-style: italic"># E: Argument 1 to &quot;Movement&quot; has incompatible type &quot;str&quot;; expected &quot;Direction&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="详尽检查">详尽检查<a class="headerlink" href="#详尽检查" title="Permanent link">&para;</a></h3>
<p>Exhaustiveness checking</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">中文</label><label for="__tabbed_9_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>与“Literal”类型类似，“Enum”支持详尽检查。 让我们从一个定义开始：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">enum</span> <span style="color: #008000; font-weight: bold">import</span> Enum
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NoReturn

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">assert_never</span>(value: NoReturn) <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #3D7B7B; font-style: italic"># 这在运行时也有效：</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000; font-weight: bold">False</span>, <span style="color: #BA2121">f&#39;This code should never be reached, got: </span><span style="color: #A45A77; font-weight: bold">{</span>value<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Direction</span>(Enum):
    up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;up&#39;</span>
    down <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;down&#39;</span>
</code></pre></div>
<p>现在，让我们使用详尽检查：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">choose_direction</span>(direction: Direction) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> direction <span style="color: #AA22FF; font-weight: bold">is</span> Direction<span style="color: #666666">.</span>up:
        reveal_type(direction)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &quot;Literal[Direction.up]&quot;</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Going up!&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    <span style="color: #008000; font-weight: bold">elif</span> direction <span style="color: #AA22FF; font-weight: bold">is</span> Direction<span style="color: #666666">.</span>down:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Down&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    <span style="color: #3D7B7B; font-style: italic"># 这条线永远不会到达</span>
    assert_never(direction)
</code></pre></div>
<p>如果我们忘记处理其中一种情况，mypy 将生成错误：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">choose_direction</span>(direction: Direction) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> direction <span style="color: #666666">==</span> Direction<span style="color: #666666">.</span>up:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Going up!&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    assert_never(direction)  <span style="color: #3D7B7B; font-style: italic"># E: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Direction&quot;; expected &quot;NoReturn&quot;</span>
</code></pre></div>
<p>匹配语句也支持详尽检查（Python 3.10 及更高版本）。</p>
</div>
<div class="tabbed-block">
<p>You may want to check that some code covers all possible <code>Literal</code> or <code>Enum</code> cases. Example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">enum</span> <span style="color: #008000; font-weight: bold">import</span> Enum
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NoReturn

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">assert_never</span>(value: NoReturn) <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #3D7B7B; font-style: italic"># 这在运行时也有效：</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000; font-weight: bold">False</span>, <span style="color: #BA2121">f&#39;This code should never be reached, got: </span><span style="color: #A45A77; font-weight: bold">{</span>value<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">&#39;</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Direction</span>(Enum):
    up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;up&#39;</span>
    down <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;down&#39;</span>
</code></pre></div>
<p>Now, let's use an exhaustiveness check:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">choose_direction</span>(direction: Direction) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> direction <span style="color: #AA22FF; font-weight: bold">is</span> Direction<span style="color: #666666">.</span>up:
        reveal_type(direction)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &quot;Literal[Direction.up]&quot;</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Going up!&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    <span style="color: #008000; font-weight: bold">elif</span> direction <span style="color: #AA22FF; font-weight: bold">is</span> Direction<span style="color: #666666">.</span>down:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Down&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    <span style="color: #3D7B7B; font-style: italic"># 这条线永远不会到达</span>
    assert_never(direction)
</code></pre></div>
<p>If we forget to handle one of the cases, mypy will generate an error:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">choose_direction</span>(direction: Direction) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> direction <span style="color: #666666">==</span> Direction<span style="color: #666666">.</span>up:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&#39;Going up!&#39;</span>)
        <span style="color: #008000; font-weight: bold">return</span>
    assert_never(direction)  <span style="color: #3D7B7B; font-style: italic"># E: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Direction&quot;; expected &quot;NoReturn&quot;</span>
</code></pre></div>
<p>Exhaustiveness checking is also supported for match statements (Python 3.10 and later).</p>
</div>
</div>
</div>
<h3 id="额外的枚举检查">额外的枚举检查<a class="headerlink" href="#额外的枚举检查" title="Permanent link">&para;</a></h3>
<p>Extra Enum checks</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">中文</label><label for="__tabbed_10_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 还尝试像 Python 运行时一样支持“Enum”的特殊功能：</p>
<ul>
<li>任何带有值的“Enum”类都是隐式的<a href="https://mypy.readthedocs.io/en/stable/final_attrs.html#final-attrs">“final”</a>. 这是 CPython 中发生的情况：</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AllDirection</span>(Direction):
<span style="color: #666666">...</span>     left <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;left&#39;</span>
<span style="color: #666666">...</span>     right <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;right&#39;</span>
Traceback (most recent call last):
    <span style="color: #666666">...</span>
<span style="color: #CB3F38; font-weight: bold">TypeError</span>: AllDirection: cannot extend enumeration <span style="color: #BA2121">&#39;Direction&#39;</span>
</code></pre></div>
<p>Mypy 也捕获了这个错误：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AllDirection</span>(Direction):  <span style="color: #3D7B7B; font-style: italic"># E: Cannot inherit from final class &quot;Direction&quot;</span>
    left <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;left&#39;</span>
    right <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;right&#39;</span>
</code></pre></div>
<p>-所有“Enum”字段也隐式为“final”。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Direction<span style="color: #666666">.</span>up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;^&#39;</span>  <span style="color: #3D7B7B; font-style: italic"># E: Cannot assign to final attribute &quot;up&quot;</span>
</code></pre></div>
<ul>
<li>检查所有字段名称是否唯一。</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Some</span>(Enum):
    x <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    x <span style="color: #666666">=</span> <span style="color: #666666">2</span>  <span style="color: #3D7B7B; font-style: italic"># E: Attempted to reuse member name &quot;x&quot; in Enum definition &quot;Some&quot;</span>
</code></pre></div>
<ul>
<li>基类没有冲突并且 mixin 类型是正确的。</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">WrongEnum</span>(<span style="color: #008000">str</span>, <span style="color: #008000">int</span>, enum<span style="color: #666666">.</span>Enum):
    <span style="color: #3D7B7B; font-style: italic"># E: Only a single data type mixin is allowed for Enum subtypes, found extra &quot;int&quot;</span>
    <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MixinAfterEnum</span>(enum<span style="color: #666666">.</span>Enum, Mixin): <span style="color: #3D7B7B; font-style: italic"># E: No base classes are allowed after &quot;enum.Enum&quot;</span>
    <span style="color: #666666">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy also tries to support special features of <code>Enum</code> the same way Python's runtime does:</p>
<ul>
<li>Any <code>Enum</code> class with values is implicitly <a href="https://mypy.readthedocs.io/en/stable/final_attrs.html#final-attrs"><code>final</code></a>. This is what happens in CPython:</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AllDirection</span>(Direction):
<span style="color: #666666">...</span>     left <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;left&#39;</span>
<span style="color: #666666">...</span>     right <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;right&#39;</span>
Traceback (most recent call last):
    <span style="color: #666666">...</span>
<span style="color: #CB3F38; font-weight: bold">TypeError</span>: AllDirection: cannot extend enumeration <span style="color: #BA2121">&#39;Direction&#39;</span>
</code></pre></div>
<p>Mypy also catches this error:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AllDirection</span>(Direction):  <span style="color: #3D7B7B; font-style: italic"># E: Cannot inherit from final class &quot;Direction&quot;</span>
    left <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;left&#39;</span>
    right <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;right&#39;</span>
</code></pre></div>
<ul>
<li>All <code>Enum</code> fields are implicitly <code>final</code> as well.</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>Direction<span style="color: #666666">.</span>up <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;^&#39;</span>  <span style="color: #3D7B7B; font-style: italic"># E: Cannot assign to final attribute &quot;up&quot;</span>
</code></pre></div>
<ul>
<li>All field names are checked to be unique.</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Some</span>(Enum):
    x <span style="color: #666666">=</span> <span style="color: #666666">1</span>
    x <span style="color: #666666">=</span> <span style="color: #666666">2</span>  <span style="color: #3D7B7B; font-style: italic"># E: Attempted to reuse member name &quot;x&quot; in Enum definition &quot;Some&quot;</span>
</code></pre></div>
<ul>
<li>Base classes have no conflicts and mixin types are correct.</li>
</ul>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">WrongEnum</span>(<span style="color: #008000">str</span>, <span style="color: #008000">int</span>, enum<span style="color: #666666">.</span>Enum):
    <span style="color: #3D7B7B; font-style: italic"># E: Only a single data type mixin is allowed for Enum subtypes, found extra &quot;int&quot;</span>
    <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MixinAfterEnum</span>(enum<span style="color: #666666">.</span>Enum, Mixin): <span style="color: #3D7B7B; font-style: italic"># E: No base classes are allowed after &quot;enum.Enum&quot;</span>
    <span style="color: #666666">...</span>
</code></pre></div>
</div>
</div>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "content.tabs.link", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.prune", "navigation.instant"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>