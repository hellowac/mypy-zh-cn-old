
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="hellowac-类型检查">
      
      
      
      
        <link rel="prev" href="../generics/">
      
      
        <link rel="next" href="../literal_and_enum/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>更多类型 - mypy静态类型检查器</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#更多类型" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
你当前浏览的版本已不是最新版本，
<a href="../../..">
    <strong>点击这里</strong>
</a>查看最新版本的文档

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="mypy静态类型检查器" class="md-header__button md-logo" aria-label="mypy静态类型检查器" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mypy静态类型检查器
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              更多类型
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  欢迎来到mypy文档!

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../" class="md-tabs__link">
          
  
    
  
  第一步

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../builtin_types/" class="md-tabs__link">
          
  
    
  
  类型系统参考

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_conf/" class="md-tabs__link">
          
  
    
  
  配置和运行mypy

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_other/" class="md-tabs__link">
          
  
    
  
  其他杂项

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../mypy_other/project_links/" class="md-tabs__link">
        
  
    
  
  项目链接

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mypy静态类型检查器" class="md-nav__button md-logo" aria-label="mypy静态类型检查器" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    mypy静态类型检查器
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欢迎来到mypy文档!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    第一步
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            第一步
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../cheat_sheet_py3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型提示备忘录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../existing_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    将 mypy 与现有代码库结合使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    类型系统参考
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            类型系统参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../builtin_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内置类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../type_inference_type_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型推断和类型注解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../kind_of_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型种类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../class_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类的基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../annotation_issue_at_runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行时的注解问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../protocol_and_struct_subtyping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    协议及其子类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_typing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../type_narrowing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型收缩
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../duck_type_compatibility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    鸭子类型兼容
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../stub_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存根文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    泛型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    更多类型
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    更多类型
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#noreturn类型" class="md-nav__link">
    NoReturn类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#newtype类型" class="md-nav__link">
    NewType类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#函数重载" class="md-nav__link">
    函数重载
  </a>
  
    <nav class="md-nav" aria-label="函数重载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#运行时行为" class="md-nav__link">
    运行时行为
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#重载的类型进行调用检查" class="md-nav__link">
    重载的类型进行调用检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#协变的类型检查" class="md-nav__link">
    协变的类型检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#类型检查的实现" class="md-nav__link">
    类型检查的实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#条件重载" class="md-nav__link">
    条件重载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self类型的高级用法" class="md-nav__link">
    self类型的高级用法
  </a>
  
    <nav class="md-nav" aria-label="self类型的高级用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#泛型类中的受限方法" class="md-nav__link">
    泛型类中的受限方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixin-类" class="md-nav__link">
    Mixin 类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#替代构造函数的精确类型" class="md-nav__link">
    替代构造函数的精确类型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#异步同步的类型检查" class="md-nav__link">
    异步/同步的类型检查
  </a>
  
    <nav class="md-nav" aria-label="异步/同步的类型检查">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#异步迭代器" class="md-nav__link">
    异步迭代器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../literal_and_enum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字面量和枚举
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../typeddict/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型字典
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../final_names_methods_classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最终名称、方法和类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../metaclasses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    元类
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_conf/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    配置和运行mypy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            配置和运行mypy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/running_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行mypy和管理导入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/command_line/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy命令行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/config_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy配置文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/inline_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内联配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/mypy_daemon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy服务(守护进程)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/installed_packages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用安装包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/extending_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扩展和集成 mypy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/stubgen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/stubtest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根测试
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_other/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    其他杂项
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            其他杂项
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/common_issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题及解决办法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/supported_python_features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    支持的 Python 特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_codes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_code_list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    默认启用的错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_code_list2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可选检查的错误代码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/additional_features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    额外特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题解答
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/project_links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    项目链接
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#noreturn类型" class="md-nav__link">
    NoReturn类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#newtype类型" class="md-nav__link">
    NewType类型
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#函数重载" class="md-nav__link">
    函数重载
  </a>
  
    <nav class="md-nav" aria-label="函数重载">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#运行时行为" class="md-nav__link">
    运行时行为
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#重载的类型进行调用检查" class="md-nav__link">
    重载的类型进行调用检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#协变的类型检查" class="md-nav__link">
    协变的类型检查
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#类型检查的实现" class="md-nav__link">
    类型检查的实现
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#条件重载" class="md-nav__link">
    条件重载
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self类型的高级用法" class="md-nav__link">
    self类型的高级用法
  </a>
  
    <nav class="md-nav" aria-label="self类型的高级用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#泛型类中的受限方法" class="md-nav__link">
    泛型类中的受限方法
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixin-类" class="md-nav__link">
    Mixin 类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#替代构造函数的精确类型" class="md-nav__link">
    替代构造函数的精确类型
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#异步同步的类型检查" class="md-nav__link">
    异步/同步的类型检查
  </a>
  
    <nav class="md-nav" aria-label="异步/同步的类型检查">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#异步迭代器" class="md-nav__link">
    异步迭代器
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="更多类型">更多类型<a class="headerlink" href="#更多类型" title="Permanent link">&para;</a></h1>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>本节介绍了一些其他类型，包括 <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a>、[<code>typing.NewType</code>]( https://docs.python.org/3/library/typing.html#typing.NewType），以及异步代码的类型。 它还讨论了如何使用重载为函数提供更精确的类型。 所有这些仅在特定情况下有用，因此请随意跳过本节，当您需要其中一些时再回来。</p>
<p>以下是本文所涵盖内容的快速摘要：</p>
<ul>
<li><a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a> 让您告诉 mypy 函数永远不会正常返回。</li>
<li><a href="https://docs.python.org/3/library/typing.html#typing.NewType"><code>typing.NewType</code></a> 允许您定义类型的协变，该协变被 mypy 视为单独的类型，但在运行时与原始类型相同。 例如，您可以将 <code>UserId</code> 作为 <code>int</code> 的协变，它在运行时只是一个<code>int</code>。</li>
<li><a href="https://docs.python.org/3/library/typing.html#typing.overload"><code>typing.overload</code></a> 让您定义一个可以接受多个不同签名的函数。 如果您需要对参数和返回类型之间的关系进行编码，而这种关系很难正常表达，那么这非常有用。</li>
<li>异步类型允许您使用 <code>async</code> 和 <code>await</code> 的同时支持检查编码类型。</li>
</ul>
</div>
<div class="tabbed-block">
<p><strong>More types</strong></p>
<p>This section introduces a few additional kinds of types, including <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a>, <a href="https://docs.python.org/3/library/typing.html#typing.NewType"><code>typing.NewType</code></a>, and types for async code. It also discusses how to give functions more precise types using overloads. All of these are only situationally useful, so feel free to skip this section and come back when you have a need for some of them.</p>
<p>Here's a quick summary of what's covered here:</p>
<ul>
<li><a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a> lets you tell mypy that a function never returns normally.</li>
<li><a href="https://docs.python.org/3/library/typing.html#typing.NewType"><code>typing.NewType</code></a> lets you define a variant of a type that is treated as a separate type by mypy but is identical to the original type at runtime. For example, you can have <code>UserId</code> as a variant of <code>int</code> that is just an <code>int</code> at runtime.</li>
<li><a href="https://docs.python.org/3/library/typing.html#typing.overload"><code>typing.overload</code></a> lets you define a function that can accept multiple distinct signatures. This is useful if you need to encode a relationship between the arguments and the return type that would be difficult to express normally.</li>
<li>Async types let you type check programs using <code>async</code> and <code>await</code>.</li>
</ul>
</div>
</div>
</div>
<h2 id="noreturn类型">NoReturn类型<a class="headerlink" href="#noreturn类型" title="Permanent link">&para;</a></h2>
<p>The NoReturn type</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 提供对永不返回的函数的支持。 例如，无条件引发异常的函数：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NoReturn

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">stop</span>() <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">Exception</span>(<span style="color: #BA2121">&#39;no way&#39;</span>)
</code></pre></div>
<p>Mypy will ensure that functions annotated as returning <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>NoReturn</code></a> truly never return, either implicitly or explicitly. Mypy will also recognize that the code after calls to such functions is unreachable and will behave accordingly:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #666666">0</span>:
        <span style="color: #008000; font-weight: bold">return</span> x
    stop()
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;whatever works&#39;</span>  <span style="color: #3D7B7B; font-style: italic"># No error in an unreachable block</span>
</code></pre></div>
<p>Mypy 将确保注释为返回 <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>NoReturn</code></a> 的函数真正永远不会返回，无论是隐式还是显式。 Mypy 还会识别出调用此类函数后的代码是无法访问的，并会做出相应的行为：</p>
<div class="language-text highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>python3 -m pip install --upgrade typing-extensions
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy provides support for functions that never return. For example, a function that unconditionally raises an exception:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NoReturn

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">stop</span>() <span style="color: #666666">-&gt;</span> NoReturn:
    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">Exception</span>(<span style="color: #BA2121">&#39;no way&#39;</span>)
</code></pre></div>
<p>Mypy will ensure that functions annotated as returning <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>NoReturn</code></a> truly never return, either implicitly or explicitly. Mypy will also recognize that the code after calls to such functions is unreachable and will behave accordingly:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(x: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
    <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">==</span> <span style="color: #666666">0</span>:
        <span style="color: #008000; font-weight: bold">return</span> x
    stop()
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&#39;whatever works&#39;</span>  <span style="color: #3D7B7B; font-style: italic"># No error in an unreachable block</span>
</code></pre></div>
<p>In earlier Python versions you need to install <code>typing_extensions</code> using pip to use <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>NoReturn</code></a> in your code. Python 3 command line:</p>
<div class="language-text highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>python3 -m pip install --upgrade typing-extensions
</code></pre></div>
</div>
</div>
</div>
<h2 id="newtype类型">NewType类型<a class="headerlink" href="#newtype类型" title="Permanent link">&para;</a></h2>
<p>NewTypes</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>在某些情况下，您可能希望通过创建仅用于区分某些值与基类实例的简单派生类来避免编程错误。 例子：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">UserId</span>(<span style="color: #008000">int</span>):
    <span style="color: #008000; font-weight: bold">pass</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_by_user_id</span>(user_id: UserId):
    <span style="color: #666666">...</span>
</code></pre></div>
<p>然而，这种方法引入了一些运行时开销。 为了避免这种情况，类型模块提供了一个辅助对象 “NewType”，它创建简单的唯一类型，运行时开销几乎为零。 
Mypy 会将语句 <code>Derived = NewType('Derived', Base)</code> 视为大致相当于以下定义：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Derived</span>(Base):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, _x: Base) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #666666">...</span>
</code></pre></div>
<p>但是，在运行时， <code>NewType('Derived', Base)</code> 将返回一个虚拟可调用对象，该可调用对象仅返回其参数：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">Derived</span>(_x):
    <span style="color: #008000; font-weight: bold">return</span> _x
</code></pre></div>
<p>Mypy 将需要从需要 “UserId” 的 “int” 显式转换，而需要“int”的地方从“UserId”隐式转换。 例子：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

UserId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;UserId&#39;</span>, <span style="color: #008000">int</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

UserId(<span style="color: #BA2121">&#39;user&#39;</span>)          <span style="color: #3D7B7B; font-style: italic"># Fails type check</span>

name_by_id(<span style="color: #666666">42</span>)          <span style="color: #3D7B7B; font-style: italic"># Fails type check</span>
name_by_id(UserId(<span style="color: #666666">42</span>))  <span style="color: #3D7B7B; font-style: italic"># OK</span>

num: <span style="color: #008000">int</span> <span style="color: #666666">=</span> UserId(<span style="color: #666666">5</span>) <span style="color: #666666">+</span> <span style="color: #666666">1</span>
</code></pre></div>
<p><code>NewType</code> 只接受两个参数。 第一个参数必须是包含新类型名称的字符串文字，并且必须等于分配新类型的变量的名称。 第二个参数必须是一个正确的可子类，即不是像 <a href="https://docs.python.org/3/library/typing.html#typing.Union"><code>Union</code></a> 等类型构造。</p>
<p><code>NewType</code> 返回的可调用对象仅接受一个参数； 这相当于只支持一个接受基类实例的构造函数（见上文）。 例子：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">PacketId</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, major: <span style="color: #008000">int</span>, minor: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_major <span style="color: #666666">=</span> major
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_minor <span style="color: #666666">=</span> minor

TcpPacketId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;TcpPacketId&#39;</span>, PacketId)

packet <span style="color: #666666">=</span> PacketId(<span style="color: #666666">100</span>, <span style="color: #666666">100</span>)
tcp_packet <span style="color: #666666">=</span> TcpPacketId(packet)  <span style="color: #3D7B7B; font-style: italic"># OK</span>

tcp_packet <span style="color: #666666">=</span> TcpPacketId(<span style="color: #666666">127</span>, <span style="color: #666666">0</span>)  <span style="color: #3D7B7B; font-style: italic"># Fails in type checker and at runtime</span>
</code></pre></div>
<p>您不能使用 <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> 或 <a href="https://docs.python.org/3/library/function.html#issubclass"><code>issubclass</code></a> 在 <code>NewType</code> 返回的对象上，也不能对 <code>NewType</code> 返回的对象进行子类化。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>与类型别名不同，“NewType” 在使用时将创建一个全新且唯一的类型。 <code>NewType</code> 的预期目的是帮助您检测意外地将旧基本类型和新派生类型混合在一起的情况。</p>
<p>例如，使用类型别名时，以下内容将成功进行类型检查：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>UserId <span style="color: #666666">=</span> <span style="color: #008000">int</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

name_by_id(<span style="color: #666666">3</span>)  <span style="color: #3D7B7B; font-style: italic"># int 和 UserId 是同义词</span>
</code></pre></div>
<p>但使用 <code>NewType</code> 的类似示例不会进行类型检查：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

UserId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;UserId&#39;</span>, <span style="color: #008000">int</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

name_by_id(<span style="color: #666666">3</span>)  <span style="color: #3D7B7B; font-style: italic"># int 与 UserId 不同</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block">
<p>There are situations where you may want to avoid programming errors by creating simple derived classes that are only used to distinguish certain values from base class instances. Example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">UserId</span>(<span style="color: #008000">int</span>):
    <span style="color: #008000; font-weight: bold">pass</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_by_user_id</span>(user_id: UserId):
    <span style="color: #666666">...</span>
</code></pre></div>
<p>However, this approach introduces some runtime overhead. To avoid this, the typing module provides a helper object <code>NewType</code> that creates simple unique types with almost zero runtime overhead. Mypy will treat the statement <code>Derived = NewType('Derived', Base)</code> as being roughly equivalent to the following definition:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Derived</span>(Base):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, _x: Base) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #666666">...</span>
</code></pre></div>
<p>However, at runtime, <code>NewType('Derived', Base)</code> will return a dummy callable that simply returns its argument:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">Derived</span>(_x):
    <span style="color: #008000; font-weight: bold">return</span> _x
</code></pre></div>
<p>Mypy will require explicit casts from <code>int</code> where <code>UserId</code> is expected, while implicitly casting from <code>UserId</code> where <code>int</code> is expected. Examples:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

UserId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;UserId&#39;</span>, <span style="color: #008000">int</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

UserId(<span style="color: #BA2121">&#39;user&#39;</span>)          <span style="color: #3D7B7B; font-style: italic"># Fails type check</span>

name_by_id(<span style="color: #666666">42</span>)          <span style="color: #3D7B7B; font-style: italic"># Fails type check</span>
name_by_id(UserId(<span style="color: #666666">42</span>))  <span style="color: #3D7B7B; font-style: italic"># OK</span>

num: <span style="color: #008000">int</span> <span style="color: #666666">=</span> UserId(<span style="color: #666666">5</span>) <span style="color: #666666">+</span> <span style="color: #666666">1</span>
</code></pre></div>
<p><code>NewType</code> accepts exactly two arguments. The first argument must be a string literal containing the name of the new type and must equal the name of the variable to which the new type is assigned. The second argument must be a properly subclassable class, i.e., not a type construct like <a href="https://docs.python.org/3/library/typing.html#typing.Union"><code>Union</code></a>, etc.</p>
<p>The callable returned by <code>NewType</code> accepts only one argument; this is equivalent to supporting only one constructor accepting an instance of the base class (see above). Example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">PacketId</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, major: <span style="color: #008000">int</span>, minor: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_major <span style="color: #666666">=</span> major
        <span style="color: #008000">self</span><span style="color: #666666">.</span>_minor <span style="color: #666666">=</span> minor

TcpPacketId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;TcpPacketId&#39;</span>, PacketId)

packet <span style="color: #666666">=</span> PacketId(<span style="color: #666666">100</span>, <span style="color: #666666">100</span>)
tcp_packet <span style="color: #666666">=</span> TcpPacketId(packet)  <span style="color: #3D7B7B; font-style: italic"># OK</span>

tcp_packet <span style="color: #666666">=</span> TcpPacketId(<span style="color: #666666">127</span>, <span style="color: #666666">0</span>)  <span style="color: #3D7B7B; font-style: italic"># Fails in type checker and at runtime</span>
</code></pre></div>
<p>You cannot use <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> or <a href="https://docs.python.org/3/library/functions.html#issubclass"><code>issubclass</code></a> on the object returned by <code>NewType</code>, nor can you subclass an object returned by <code>NewType</code>.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Unlike type aliases, <code>NewType</code> will create an entirely new and unique type when used. The intended purpose of <code>NewType</code> is to help you detect cases where you accidentally mixed together the old base type and the new derived type.</p>
<p>For example, the following will successfully typecheck when using type aliases:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>UserId <span style="color: #666666">=</span> <span style="color: #008000">int</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

name_by_id(<span style="color: #666666">3</span>)  <span style="color: #3D7B7B; font-style: italic"># ints and UserId are synonymous</span>
</code></pre></div>
<p>But a similar example using <code>NewType</code> will not typecheck:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> NewType

UserId <span style="color: #666666">=</span> NewType(<span style="color: #BA2121">&#39;UserId&#39;</span>, <span style="color: #008000">int</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">name_by_id</span>(user_id: UserId) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #666666">...</span>

name_by_id(<span style="color: #666666">3</span>)  <span style="color: #3D7B7B; font-style: italic"># int is not the same as UserId</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h2 id="函数重载">函数重载<a class="headerlink" href="#函数重载" title="Permanent link">&para;</a></h2>
<p>Function overloading</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>有时，函数中的参数和类型彼此依赖，而无法使用 <a href="https://docs.python.org/3/library/typing.html#typing.Union"><code>Union</code></a> 捕获 。 例如，假设我们要编写一个可以接受 x-y 坐标的函数。 如果我们只传入一个 x-y 坐标，我们将返回一个 “ClickEvent” 对象。 但是，如果我们传入两个 x-y 坐标，我们将返回一个 “DragEvent” 对象。</p>
<p>我们第一次尝试编写这个函数可能如下所示：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Union, Optional

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>,
                y1: <span style="color: #008000">int</span>,
                x2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
                y2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> Union[ClickEvent, DragEvent]:
    <span style="color: #008000; font-weight: bold">if</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> ClickEvent(x1, y1)
    <span style="color: #008000; font-weight: bold">elif</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> DragEvent(x1, y1, x2, y2)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #BA2121">&quot;Bad arguments&quot;</span>)
</code></pre></div>
<p>虽然这个函数签名有效，但它太松散了：它意味着无论我们传入的参数数量如何，“mouse_event” 都可以返回任一对象。它也不禁止调用者传入错误数量的整数：mypy 会像这样对待调用 例如，“mouse_event(1, 2, 20)” 是有效的。</p>
<p>我们可以通过使用 <a href="https://peps.python.org/pep-0484/#function-method-overloading"><code>overloading</code></a> 做得更好，它可以让我们为同一个函数提供多个类型注释（签名）以更准确地描述函数的行为：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Union, overload

<span style="color: #3D7B7B; font-style: italic"># 重载“mouse_event”的*协变*。</span>
<span style="color: #3D7B7B; font-style: italic"># 这些协变为类型检查器提供了额外的信息。</span>
<span style="color: #3D7B7B; font-style: italic"># 它们在运行时被忽略。</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>, y1: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> ClickEvent: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>, y1: <span style="color: #008000">int</span>, x2: <span style="color: #008000">int</span>, y2: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> DragEvent: <span style="color: #666666">...</span>

<span style="color: #3D7B7B; font-style: italic"># “mouse_event”的实际*实现*。</span>
<span style="color: #3D7B7B; font-style: italic"># 实现包含实际的运行时逻辑。</span>
<span style="color: #3D7B7B; font-style: italic">#</span>
<span style="color: #3D7B7B; font-style: italic"># 它可能有也可能没有类型提示。 如果是，mypy 将根据类型提示检查实现的主体。</span>
<span style="color: #3D7B7B; font-style: italic">#</span>
<span style="color: #3D7B7B; font-style: italic"># Mypy 还将检查并确保签名与提供的协变一致。</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>,
                y1: <span style="color: #008000">int</span>,
                x2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
                y2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> Union[ClickEvent, DragEvent]:
    <span style="color: #008000; font-weight: bold">if</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> ClickEvent(x1, y1)
    <span style="color: #008000; font-weight: bold">elif</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> DragEvent(x1, y1, x2, y2)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #BA2121">&quot;Bad arguments&quot;</span>)
</code></pre></div>
<p>这使得 mypy 能够更准确地理解对 “mouse_event” 的调用。 例如，mypy 将理解 “mouse_event(5, 25)” 将始终具有 “ClickEvent” 的返回类型，并将报告 “mouse_event(5, 25, 2)” 等调用的错误。</p>
<p>另一个例子，假设我们要编写一个自定义容器类来实现 <a href="https://docs.python.org/3/reference/datamodel.html#object.__getitem__"><code>__getitem__</code></a> 方法 (<code>[]</code> 括号索引）。 如果此方法接收到一个整数，我们将返回一个项目。 如果它收到一个“切片”，我们将返回一个项目的<a href="https://docs.python.org/3/library/typing.html#typing.Sequence">“序列”</a>。</p>
<p>我们可以通过使用重载来精确编码参数和返回类型之间的关系，如下所示：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Sequence, TypeVar, Union, overload

T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyList</span>(Sequence[T]):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> T: <span style="color: #666666">...</span>

    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: <span style="color: #008000">slice</span>) <span style="color: #666666">-&gt;</span> Sequence[T]: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: Union[<span style="color: #008000">int</span>, <span style="color: #008000">slice</span>]) <span style="color: #666666">-&gt;</span> Union[T, Sequence[T]]:
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(index, <span style="color: #008000">int</span>):
            <span style="color: #3D7B7B; font-style: italic"># Return a T here</span>
        <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(index, <span style="color: #008000">slice</span>):
            <span style="color: #3D7B7B; font-style: italic"># Return a sequence of Ts here</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #666666">...</span>)
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>如果您只需要将类型变量限制为某些类型或子类型，则可以使用<a href="https://mypy.readthedocs.io/en/stable/generics.html#type-variable-value-restriction"><code>值限制</code></a>。</p>
</div>
<p>函数参数的默认值不会影响其签名——只有默认值的缺失或存在才会影响。 因此，为了减少冗余，可以用“...”作为占位符来替换重载定义中的默认值：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">M</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: M, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> M: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: <span style="color: #008000">int</span>, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> M <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: <span style="color: #008000">int</span> <span style="color: #666666">|</span> M, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">True</span>) <span style="color: #666666">-&gt;</span> M <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #666666">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Sometimes the arguments and types in a function depend on each other in ways that can't be captured with a <a href="https://docs.python.org/3/library/typing.html#typing.Union"><code>Union</code></a>. For example, suppose we want to write a function that can accept x-y coordinates. If we pass in just a single x-y coordinate, we return a <code>ClickEvent</code> object. However, if we pass in two x-y coordinates, we return a <code>DragEvent</code> object.</p>
<p>Our first attempt at writing this function might look like this:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Union, Optional

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>,
                y1: <span style="color: #008000">int</span>,
                x2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
                y2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> Union[ClickEvent, DragEvent]:
    <span style="color: #008000; font-weight: bold">if</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> ClickEvent(x1, y1)
    <span style="color: #008000; font-weight: bold">elif</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> DragEvent(x1, y1, x2, y2)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #BA2121">&quot;Bad arguments&quot;</span>)
</code></pre></div>
<p>While this function signature works, it's too loose: it implies <code>mouse_event</code> could return either object regardless of the number of arguments we pass in. It also does not prohibit a caller from passing in the wrong number of ints: mypy would treat calls like <code>mouse_event(1, 2, 20)</code> as being valid, for example.</p>
<p>We can do better by using <a href="https://peps.python.org/pep-0484/#function-method-overloading"><code>overloading</code></a> which lets us give the same function multiple type annotations (signatures) to more accurately describe the function's behavior:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Union, overload

<span style="color: #3D7B7B; font-style: italic"># Overload *variants* for &#39;mouse_event&#39;.</span>
<span style="color: #3D7B7B; font-style: italic"># These variants give extra information to the type checker.</span>
<span style="color: #3D7B7B; font-style: italic"># They are ignored at runtime.</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>, y1: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> ClickEvent: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>, y1: <span style="color: #008000">int</span>, x2: <span style="color: #008000">int</span>, y2: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> DragEvent: <span style="color: #666666">...</span>

<span style="color: #3D7B7B; font-style: italic"># The actual *implementation* of &#39;mouse_event&#39;.</span>
<span style="color: #3D7B7B; font-style: italic"># The implementation contains the actual runtime logic.</span>
<span style="color: #3D7B7B; font-style: italic">#</span>
<span style="color: #3D7B7B; font-style: italic"># It may or may not have type hints. If it does, mypy</span>
<span style="color: #3D7B7B; font-style: italic"># will check the body of the implementation against the</span>
<span style="color: #3D7B7B; font-style: italic"># type hints.</span>
<span style="color: #3D7B7B; font-style: italic">#</span>
<span style="color: #3D7B7B; font-style: italic"># Mypy will also check and make sure the signature is</span>
<span style="color: #3D7B7B; font-style: italic"># consistent with the provided variants.</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mouse_event</span>(x1: <span style="color: #008000">int</span>,
                y1: <span style="color: #008000">int</span>,
                x2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>,
                y2: Optional[<span style="color: #008000">int</span>] <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">None</span>) <span style="color: #666666">-&gt;</span> Union[ClickEvent, DragEvent]:
    <span style="color: #008000; font-weight: bold">if</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> ClickEvent(x1, y1)
    <span style="color: #008000; font-weight: bold">elif</span> x2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span> <span style="color: #AA22FF; font-weight: bold">and</span> y2 <span style="color: #AA22FF; font-weight: bold">is</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000; font-weight: bold">return</span> DragEvent(x1, y1, x2, y2)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #BA2121">&quot;Bad arguments&quot;</span>)
</code></pre></div>
<p>This allows mypy to understand calls to <code>mouse_event</code> much more precisely. For example, mypy will understand that <code>mouse_event(5, 25)</code> will always have a return type of <code>ClickEvent</code> and will report errors for calls like <code>mouse_event(5, 25, 2)</code>.</p>
<p>As another example, suppose we want to write a custom container class that implements the <a href="https://docs.python.org/3/reference/datamodel.html#object.__getitem__"><code>__getitem__</code></a> method (<code>[]</code> bracket indexing). If this method receives an integer we return a single item. If it receives a <code>slice</code>, we return a <a href="https://docs.python.org/3/library/typing.html#typing.Sequence"><code>Sequence</code></a> of items.</p>
<p>We can precisely encode this relationship between the argument and the return type by using overloads like so:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Sequence, TypeVar, Union, overload

T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyList</span>(Sequence[T]):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> T: <span style="color: #666666">...</span>

    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: <span style="color: #008000">slice</span>) <span style="color: #666666">-&gt;</span> Sequence[T]: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__getitem__</span>(<span style="color: #008000">self</span>, index: Union[<span style="color: #008000">int</span>, <span style="color: #008000">slice</span>]) <span style="color: #666666">-&gt;</span> Union[T, Sequence[T]]:
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(index, <span style="color: #008000">int</span>):
            <span style="color: #3D7B7B; font-style: italic"># Return a T here</span>
        <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(index, <span style="color: #008000">slice</span>):
            <span style="color: #3D7B7B; font-style: italic"># Return a sequence of Ts here</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">TypeError</span>(<span style="color: #666666">...</span>)
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>If you just need to constrain a type variable to certain types or subtypes, you can use a <a href="https://mypy.readthedocs.io/en/stable/generics.html#type-variable-value-restriction"><code>value restriction</code></a>.</p>
</div>
<p>The default values of a function's arguments don't affect its signature -- only the absence or presence of a default value does. So in order to reduce redundancy, it's possible to replace default values in overload definitions with <code>...</code> as a placeholder:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">M</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: M, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> M: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: <span style="color: #008000">int</span>, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> M <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">get_model</span>(model_or_pk: <span style="color: #008000">int</span> <span style="color: #666666">|</span> M, flag: <span style="color: #008000">bool</span> <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">True</span>) <span style="color: #666666">-&gt;</span> M <span style="color: #666666">|</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #666666">...</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="运行时行为">运行时行为<a class="headerlink" href="#运行时行为" title="Permanent link">&para;</a></h3>
<p>Runtime behavior</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">中文</label><label for="__tabbed_5_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>重载函数必须由两个或多个重载<em>协变</em>组成，后跟一个<em>实现</em>。 协变和实现在代码中必须相邻：将它们视为一个不可分割的单元。</p>
<p>协变主体必须全部为空； 仅允许实现包含代码。 这是因为在运行时，协变被完全忽略：它们被最终的实现函数覆盖。</p>
<p>这意味着重载函数仍然是普通的Python函数！ 没有自动调度处理，您必须手动处理实现中的不同类型（例如，通过使用 <code>if</code> 语句和 <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> 检查)。</p>
<p>如果要在存根文件中添加重载，则应省略实现函数：存根不包含运行时逻辑。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>虽然我们可以使用 “pass” 关键字将协变主体留空，但更常见的约定是使用省略号（“...”）文字。</p>
</div>
</div>
<div class="tabbed-block">
<p>An overloaded function must consist of two or more overload <em>variants</em> followed by an <em>implementation</em>. The variants and the implementations must be adjacent in the code: think of them as one indivisible unit.</p>
<p>The variant bodies must all be empty; only the implementation is allowed to contain code. This is because at runtime, the variants are completely ignored: they're overridden by the final implementation function.</p>
<p>This means that an overloaded function is still an ordinary Python function! There is no automatic dispatch handling and you must manually handle the different types in the implementation (e.g. by using <code>if</code> statements and <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> checks).</p>
<p>If you are adding an overload within a stub file, the implementation function should be omitted: stubs do not contain runtime logic.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>While we can leave the variant body empty using the <code>pass</code> keyword, the more common convention is to instead use the ellipsis (<code>...</code>) literal.</p>
</div>
</div>
</div>
</div>
<h3 id="重载的类型进行调用检查">重载的类型进行调用检查<a class="headerlink" href="#重载的类型进行调用检查" title="Permanent link">&para;</a></h3>
<p>Type checking calls to overloads</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">中文</label><label for="__tabbed_6_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>当您调用重载函数时，mypy 将在考虑参数类型和数量后，通过选择最佳匹配协变来推断正确的返回类型。 然而，调用永远不会根据实现进行类型检查。 这就是为什么 mypy 会报告像 “mouse_event(5, 25, 3)” 这样的调用无效，即使它与实现签名匹配。</p>
<p>如果有多个同样好的匹配协变，mypy 将选择最先定义的协变。 例如，考虑以下程序：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># For Python 3.8 and below you must use `typing.List` instead of `list`. e.g.</span>
<span style="color: #3D7B7B; font-style: italic"># from typing import List</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data: <span style="color: #008000">list</span>[<span style="color: #008000">int</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">float</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> data:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0.0</span>
    <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(data[<span style="color: #666666">0</span>], <span style="color: #008000">int</span>):
        <span style="color: #3D7B7B; font-style: italic"># Do int specific code</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #3D7B7B; font-style: italic"># Do str-specific code</span>

<span style="color: #3D7B7B; font-style: italic"># What is the type of &#39;output&#39;? float or str?</span>
output <span style="color: #666666">=</span> summarize([])
</code></pre></div>
<p><code>summarize([])</code> 调用匹配两种协变：空列表可以是 <code>list[int]</code> 或 <code>list[str]</code>。 在这种情况下，mypy 将通过选择第一个匹配的协变来打破平局：“output” 将具有 “float” 的推断类型。 实现者负责确保 “summarize” 在运行时以相同的方式打破联系。</p>
<p>但是，“选择第一个匹配项” 规则有两个例外。 首先，如果由于参数类型为“Any”而导致多个协变匹配，则 mypy 将使推断类型也为“Any”：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>dynamic_var: Any <span style="color: #666666">=</span> some_dynamic_function()

<span style="color: #3D7B7B; font-style: italic"># output2 is of type &#39;Any&#39;</span>
output2 <span style="color: #666666">=</span> summarize(dynamic_var)
</code></pre></div>
<p>其次，如果由于一个或多个参数是联合而导致多个协变匹配，则 mypy 将使推断类型成为匹配协变返回的并集：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_list: Union[<span style="color: #008000">list</span>[<span style="color: #008000">int</span>], <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]

<span style="color: #3D7B7B; font-style: italic"># output3 is of type &#39;Union[float, str]&#39;</span>
output3 <span style="color: #666666">=</span> summarize(some_list)
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>由于“选择第一个匹配”规则，更改重载协变的顺序可以更改 mypy 类型检查程序的方式。</p>
<p>为了尽量减少潜在问题，我们建议您：</p>
<ol>
<li>确保您的重载协变以与实现中运行时检查（例如 <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> 检查）相同的顺序列出。</li>
<li>按照从最具体到最不具体的顺序对协变和运行时检查进行排序。（有关示例，请参阅以下部分）。</li>
</ol>
</div>
</div>
<div class="tabbed-block">
<p>When you call an overloaded function, mypy will infer the correct return type by picking the best matching variant, after taking into consideration both the argument types and arity. However, a call is never type checked against the implementation. This is why mypy will report calls like <code>mouse_event(5, 25, 3)</code> as being invalid even though it matches the implementation signature.</p>
<p>If there are multiple equally good matching variants, mypy will select the variant that was defined first. For example, consider the following program:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># For Python 3.8 and below you must use `typing.List` instead of `list`. e.g.</span>
<span style="color: #3D7B7B; font-style: italic"># from typing import List</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data: <span style="color: #008000">list</span>[<span style="color: #008000">int</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">float</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">summarize</span>(data):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> data:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0.0</span>
    <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(data[<span style="color: #666666">0</span>], <span style="color: #008000">int</span>):
        <span style="color: #3D7B7B; font-style: italic"># Do int specific code</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #3D7B7B; font-style: italic"># Do str-specific code</span>

<span style="color: #3D7B7B; font-style: italic"># What is the type of &#39;output&#39;? float or str?</span>
output <span style="color: #666666">=</span> summarize([])
</code></pre></div>
<p>The <code>summarize([])</code> call matches both variants: an empty list could be either a <code>list[int]</code> or a <code>list[str]</code>. In this case, mypy will break the tie by picking the first matching variant: <code>output</code> will have an inferred type of <code>float</code>. The implementor is responsible for making sure <code>summarize</code> breaks ties in the same way at runtime.</p>
<p>However, there are two exceptions to the "pick the first match" rule. First, if multiple variants match due to an argument being of type <code>Any</code>, mypy will make the inferred type also be <code>Any</code>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>dynamic_var: Any <span style="color: #666666">=</span> some_dynamic_function()

<span style="color: #3D7B7B; font-style: italic"># output2 is of type &#39;Any&#39;</span>
output2 <span style="color: #666666">=</span> summarize(dynamic_var)
</code></pre></div>
<p>Second, if multiple variants match due to one or more of the arguments being a union, mypy will make the inferred type be the union of the matching variant returns:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_list: Union[<span style="color: #008000">list</span>[<span style="color: #008000">int</span>], <span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]

<span style="color: #3D7B7B; font-style: italic"># output3 is of type &#39;Union[float, str]&#39;</span>
output3 <span style="color: #666666">=</span> summarize(some_list)
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Due to the "pick the first match" rule, changing the order of your overload variants can change how mypy type checks your program.</p>
<p>To minimize potential issues, we recommend that you:</p>
<ol>
<li>Make sure your overload variants are listed in the same order as
the runtime checks (e.g. <a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> checks) in your implementation.</li>
<li>Order your variants and runtime checks from most to least specific.
(See the following section for an example).</li>
</ol>
</div>
</div>
</div>
</div>
<h3 id="协变的类型检查">协变的类型检查<a class="headerlink" href="#协变的类型检查" title="Permanent link">&para;</a></h3>
<p>Type checking the variants</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">中文</label><label for="__tabbed_7_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 将对您的重载协变定义执行多次检查，以确保它们的行为符合预期。 首先，mypy 将检查并确保没有重载协变遮盖后续协变。 例如，考虑以下函数，它将两个“Expression”对象加在一起，并包含一个特殊情况来处理接收两个“Literal”类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Expression</span>:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Literal</span>(Expression):
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>

<span style="color: #3D7B7B; font-style: italic"># Warning -- the first overload variant shadows the second!</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Literal, right: Literal) <span style="color: #666666">-&gt;</span> Literal: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>
</code></pre></div>
<p>虽然此代码片段在技术上是类型安全的，但它确实包含反模式：永远不会选择第二个协变！ 如果我们尝试调用“add(Literal(3), Literal(4))”，mypy 将始终选择第一个协变并将函数调用评估为“Expression”类型，而不是“Literal”。 这是因为 <code>Literal</code> 是 <code>Expression</code> 的子类型，这意味着“选择第一个匹配”规则在考虑第一次重载后将始终停止。</p>
<p>因为拥有永远无法匹配的重载协变几乎肯定是一个错误，所以 mypy 将报告错误。 要修复该错误，我们可以 1) 删除第二个重载或 2) 交换重载的顺序：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># Everything is ok now -- the variants are correctly ordered</span>
<span style="color: #3D7B7B; font-style: italic"># from most to least specific.</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Literal, right: Literal) <span style="color: #666666">-&gt;</span> Literal: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>
</code></pre></div>
<p>Mypy 还将对不同的协变进行类型检查，并标记任何具有本质上不安全的重叠协变的重载。 例如，考虑以下不安全重载定义：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">int</span>, <span style="color: #008000">str</span>]:
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(x, <span style="color: #008000">int</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">42</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;some string&quot;</span>
</code></pre></div>
<p>从表面上看，这个函数定义似乎没问题。 但是，当我们尝试像这样使用它时，会导致推断类型与实际运行时类型之间存在差异：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_obj: <span style="color: #008000">object</span> <span style="color: #666666">=</span> <span style="color: #666666">42</span>
unsafe_func(some_obj) <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; danger danger&quot;</span>  <span style="color: #3D7B7B; font-style: italic"># Type checks, yet crashes at runtime!</span>
</code></pre></div>
<p>由于 <code>some_obj</code> 的类型为 <a href="https://docs.python.org/3/library/functions.html#object"><code>object</code></a>，mypy 将决定 <code>unsafe_func</code> 必须返回 <code>str</code> 类型的内容，并且 总结以上内容将进行类型检查。 但实际上，<code>unsafe_func</code>会返回一个int，导致代码在运行时崩溃！</p>
<p>为了防止此类问题，mypy 将尽最大努力检测并禁止本质上不安全的重叠重载。 当以下两个条件都成立时，两个变体被视为不安全重叠：</p>
<ol>
<li>第一个变体的所有参数都与第二个变体兼容。</li>
<li>第一个变体的返回类型与第二个变体“不”兼容（例如不是其子类型）。</li>
</ol>
<p>因此，在此示例中，第一个变体中的 “int” 参数是第二个变体中 “object” 参数的子类型，但 “int” 返回类型不是 “str” 的子类型。 这两个条件都成立，因此 mypy 会正确地将 <code>unsafe_func</code> 标记为不安全。</p>
<p>但是，mypy 不会检测 <em>所有</em> 不安全的重载使用。 例如，假设我们修改上面的代码片段，使其调用 “summarize” 而不是 “unsafe_func” ：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_list: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>] <span style="color: #666666">=</span> []
summarize(some_list) <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;danger danger&quot;</span>  <span style="color: #3D7B7B; font-style: italic"># Type safe, yet crashes at runtime!</span>
</code></pre></div>
<p>我们在这里遇到了类似的问题。 该程序类型检查我们是否只查看重载上的注释。 但由于“summarize(...)”被设计为在接收到空列表时偏向于返回浮点数，因此该程序实际上会在运行时崩溃。</p>
<p>mypy 没有将像“summarize”这样的定义标记为潜在不安全的原因是，如果这样做，编写安全重载将非常困难。 例如，假设我们定义一个具有两个分别接受类型“A”和“B”的变体的重载。 即使这两种类型完全不相关，用户仍然可能通过传入继承自“A”和“B”的第三种类型“C”的值来触发与上述类似的运行时错误。</p>
<p>值得庆幸的是，此类情况相对较少。 然而，这确实意味着，在设计或使用重载函数时应该小心谨慎，因为该重载函数可能会接收两个看似不相关类型的实例值。</p>
</div>
<div class="tabbed-block">
<p>Mypy will perform several checks on your overload variant definitions to ensure they behave as expected. First, mypy will check and make sure that no overload variant is shadowing a subsequent one. For example, consider the following function which adds together two <code>Expression</code> objects, and contains a special-case to handle receiving two <code>Literal</code> types:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Expression</span>:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Literal</span>(Expression):
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>

<span style="color: #3D7B7B; font-style: italic"># Warning -- the first overload variant shadows the second!</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Literal, right: Literal) <span style="color: #666666">-&gt;</span> Literal: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>
</code></pre></div>
<p>While this code snippet is technically type-safe, it does contain an anti-pattern: the second variant will never be selected! If we try calling <code>add(Literal(3), Literal(4))</code>, mypy will always pick the first variant and evaluate the function call to be of type <code>Expression</code>, not <code>Literal</code>. This is because <code>Literal</code> is a subtype of <code>Expression</code>, which means the "pick the first match" rule will always halt after considering the first overload.</p>
<p>Because having an overload variant that can never be matched is almost certainly a mistake, mypy will report an error. To fix the error, we can either 1) delete the second overload or 2) swap the order of the overloads:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># Everything is ok now -- the variants are correctly ordered</span>
<span style="color: #3D7B7B; font-style: italic"># from most to least specific.</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Literal, right: Literal) <span style="color: #666666">-&gt;</span> Literal: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">add</span>(left: Expression, right: Expression) <span style="color: #666666">-&gt;</span> Expression:
    <span style="color: #3D7B7B; font-style: italic"># ...snip...</span>
</code></pre></div>
<p>Mypy will also type check the different variants and flag any overloads that have inherently unsafely overlapping variants. For example, consider the following unsafe overload definition:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> overload, Union

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">unsafe_func</span>(x: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> Union[<span style="color: #008000">int</span>, <span style="color: #008000">str</span>]:
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(x, <span style="color: #008000">int</span>):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">42</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;some string&quot;</span>
</code></pre></div>
<p>On the surface, this function definition appears to be fine. However, it will result in a discrepancy between the inferred type and the actual runtime type when we try using it like so:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_obj: <span style="color: #008000">object</span> <span style="color: #666666">=</span> <span style="color: #666666">42</span>
unsafe_func(some_obj) <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; danger danger&quot;</span>  <span style="color: #3D7B7B; font-style: italic"># Type checks, yet crashes at runtime!</span>
</code></pre></div>
<p>Since <code>some_obj</code> is of type <a href="https://docs.python.org/3/library/functions.html#object"><code>object</code></a>, mypy will decide that <code>unsafe_func</code> must return something of type <code>str</code> and concludes the above will type check. But in reality, <code>unsafe_func</code> will return an int, causing the code to crash at runtime!</p>
<p>To prevent these kinds of issues, mypy will detect and prohibit inherently unsafely overlapping overloads on a best-effort basis. Two variants are considered unsafely overlapping when both of the following are true:</p>
<ol>
<li>All of the arguments of the first variant are compatible with the second.</li>
<li>The return type of the first variant is <em>not</em> compatible with (e.g. is not a subtype of) the second.</li>
</ol>
<p>So in this example, the <code>int</code> argument in the first variant is a subtype of the <code>object</code> argument in the second, yet the <code>int</code> return type is not a subtype of <code>str</code>. Both conditions are true, so mypy will correctly flag <code>unsafe_func</code> as being unsafe.</p>
<p>However, mypy will not detect <em>all</em> unsafe uses of overloads. For example, suppose we modify the above snippet so it calls <code>summarize</code> instead of <code>unsafe_func</code>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>some_list: <span style="color: #008000">list</span>[<span style="color: #008000">str</span>] <span style="color: #666666">=</span> []
summarize(some_list) <span style="color: #666666">+</span> <span style="color: #BA2121">&quot;danger danger&quot;</span>  <span style="color: #3D7B7B; font-style: italic"># Type safe, yet crashes at runtime!</span>
</code></pre></div>
<p>We run into a similar issue here. This program type checks if we look just at the annotations on the overloads. But since <code>summarize(...)</code> is designed to be biased towards returning a float when it receives an empty list, this program will actually crash during runtime.</p>
<p>The reason mypy does not flag definitions like <code>summarize</code> as being potentially unsafe is because if it did, it would be extremely difficult to write a safe overload. For example, suppose we define an overload with two variants that accept types <code>A</code> and <code>B</code> respectively. Even if those two types were completely unrelated, the user could still potentially trigger a runtime error similar to the ones above by passing in a value of some third type <code>C</code> that inherits from both <code>A</code> and <code>B</code>.</p>
<p>Thankfully, these types of situations are relatively rare. What this does mean, however, is that you should exercise caution when designing or using an overloaded function that can potentially receive values that are an instance of two seemingly unrelated types.</p>
</div>
</div>
</div>
<h3 id="类型检查的实现">类型检查的实现<a class="headerlink" href="#类型检查的实现" title="Permanent link">&para;</a></h3>
<p>Type checking the implementation</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">中文</label><label for="__tabbed_8_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>实现的主体根据实现上提供的类型提示进行类型检查。 例如，在上面的 “MyList” 示例中，主体中的代码使用参数列表 “index: Union[int, slice]” 和返回类型 “Union[T, Sequence[T]]” 进行检查。 如果实现上没有注释，则不会对主体进行类型检查。 如果您想强制 mypy 检查主体，请使用 <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-check-untyped-defs"><code>--check-untyped-defs</code></a> 标志（<a href="https://mypy.readthedocs.io/en/stable/command_line.html#untyped-definitions-and-calls"><code>更多详细信息请参见此处</code></a>）。</p>
<p>这些变体还必须与实现类型提示兼容。 在 “MyList” 示例中，mypy 将检查参数类型“int”和返回类型“T”是否与第一个变体的“Union[int, slice]”和“Union[T, Sequence]”兼容。 对于第二个变体，它验证参数类型“slice”和返回类型“Sequence[T]”与“Union[int, slice]”和“Union[T, Sequence]”兼容。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>上面记录的重载语义是从 mypy 0.620 开始的新语义。</p>
<p>以前，mypy 用于对所有重载变体执行类型擦除。 例如，上一节中的 “summarize” 示例过去是非法的，因为“list[str]”和“list[int]”都被删除为“list[Any]”。 mypy 0.620 中删除了此限制。</p>
<p>Mypy 之前还使用不同的算法来选择最佳匹配变体。 如果此算法未能找到匹配项，则默认返回“Any”。 新算法使用“选择第一个匹配”规则，并且仅当输入参数也包含“Any”时才会回退到返回“Any”。</p>
</div>
</div>
<div class="tabbed-block">
<p>The body of an implementation is type-checked against the type hints provided on the implementation. For example, in the <code>MyList</code> example up above, the code in the body is checked with argument list <code>index: Union[int, slice]</code> and a return type of <code>Union[T, Sequence[T]]</code>. If there are no annotations on the implementation, then the body is not type checked. If you want to force mypy to check the body anyways, use the <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-check-untyped-defs"><code>--check-untyped-defs</code></a> flag (<a href="https://mypy.readthedocs.io/en/stable/command_line.html#untyped-definitions-and-calls"><code>more details here</code></a>).</p>
<p>The variants must also also be compatible with the implementation type hints. In the <code>MyList</code> example, mypy will check that the parameter type <code>int</code> and the return type <code>T</code> are compatible with <code>Union[int, slice]</code> and <code>Union[T, Sequence]</code> for the first variant. For the second variant it verifies the parameter type <code>slice</code> and the return type <code>Sequence[T]</code> are compatible with <code>Union[int, slice]</code> and <code>Union[T, Sequence]</code>.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>The overload semantics documented above are new as of mypy 0.620.</p>
<p>Previously, mypy used to perform type erasure on all overload variants. For example, the <code>summarize</code> example from the previous section used to be illegal because <code>list[str]</code> and <code>list[int]</code> both erased to just <code>list[Any]</code>. This restriction was removed in mypy 0.620.</p>
<p>Mypy also previously used to select the best matching variant using a different algorithm. If this algorithm failed to find a match, it would default to returning <code>Any</code>. The new algorithm uses the "pick the first match" rule and will fall back to returning <code>Any</code> only if the input arguments also contain <code>Any</code>.</p>
</div>
</div>
</div>
</div>
<h3 id="条件重载">条件重载<a class="headerlink" href="#条件重载" title="Permanent link">&para;</a></h3>
<p>Conditional overloads</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">中文</label><label for="__tabbed_9_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>有时有条件地定义重载很有用。 常见用例包括运行时不可用的类型或仅存在于特定 Python 版本中的类型。 所有现有的超载规则仍然适用。 例如，必须至少有两个重载。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Mypy 只能推断有限数量的条件。 目前支持的包括 <a href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING"><code>TYPE_CHECKING</code></a>, <code>MYPY</code>, <a href="https://mypy.readthedocs.io/en/stable/common_issues.html#version-and-platform-checks"><code>version_and_platform_checks</code></a>, <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-always-true"><code>--always-true</code></a>, 和 <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-always-false"><code>--always-false</code></a> 等.</p>
</div>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TYPE_CHECKING, Any, overload

<span style="color: #008000; font-weight: bold">if</span> TYPE_CHECKING:
    <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">if</span> TYPE_CHECKING:
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any:
    <span style="color: #008000; font-weight: bold">return</span> var

reveal_type(func(A()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;A&quot;</span>
</code></pre></div>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># flags: --python-version 3.10</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Any, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">C</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">D</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">if</span> sys<span style="color: #666666">.</span>version_info <span style="color: #666666">&lt;</span> (<span style="color: #666666">3</span>, <span style="color: #666666">7</span>):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">elif</span> sys<span style="color: #666666">.</span>version_info <span style="color: #666666">&gt;=</span> (<span style="color: #666666">3</span>, <span style="color: #666666">10</span>):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">else</span>:
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: C) <span style="color: #666666">-&gt;</span> C: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: D) <span style="color: #666666">-&gt;</span> D: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any:
    <span style="color: #008000; font-weight: bold">return</span> var


reveal_type(func(B()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;B&quot;</span>
reveal_type(func(C()))  <span style="color: #3D7B7B; font-style: italic"># No overload variant of &quot;func&quot; matches argument type &quot;C&quot;</span>
    <span style="color: #3D7B7B; font-style: italic"># Possible overload variants:</span>
    <span style="color: #3D7B7B; font-style: italic">#     def func(var: B) -&gt; B</span>
    <span style="color: #3D7B7B; font-style: italic">#     def func(var: D) -&gt; D</span>
    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Any&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>在最后一个示例中，mypy 使用 <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-python-version"><code>--python-version 3.10</code></a> 执行.</p>
<p>因此，条件“sys.version_info &gt;= (3, 10)”将匹配，并且将添加“B”的重载。</p>
<p><code>A</code> 和 <code>C</code> 的重载被忽略！</p>
<p>“D”的重载没有条件定义，因此也被添加。</p>
</div>
<p>当 mypy 无法推断条件始终为“True”或始终为“False”时，会发出错误。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Any, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">g</span>(bool_var: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> bool_var:  <span style="color: #3D7B7B; font-style: italic"># Condition can&#39;t be inferred, unable to merge overloads</span>
        <span style="color: #AA22FF">@overload</span>
        <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

        <span style="color: #AA22FF">@overload</span>
        <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any: <span style="color: #666666">...</span>

    reveal_type(func(A()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Any&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Sometimes it is useful to define overloads conditionally. Common use cases include types that are unavailable at runtime or that only exist in a certain Python version. All existing overload rules still apply. For example, there must be at least two overloads.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Mypy can only infer a limited number of conditions. Supported ones currently include <a href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING"><code>TYPE_CHECKING</code></a>, <code>MYPY</code>, <a href="https://mypy.readthedocs.io/en/stable/common_issues.html#version-and-platform-checks"><code>version_and_platform_checks</code></a>, <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-always-true"><code>--always-true</code></a>, and <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-always-false"><code>--always-false</code></a> values.</p>
</div>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TYPE_CHECKING, Any, overload

<span style="color: #008000; font-weight: bold">if</span> TYPE_CHECKING:
    <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
    <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">if</span> TYPE_CHECKING:
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any:
    <span style="color: #008000; font-weight: bold">return</span> var

reveal_type(func(A()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;A&quot;</span>
</code></pre></div>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #3D7B7B; font-style: italic"># flags: --python-version 3.10</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sys</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Any, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">C</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">D</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">if</span> sys<span style="color: #666666">.</span>version_info <span style="color: #666666">&lt;</span> (<span style="color: #666666">3</span>, <span style="color: #666666">7</span>):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">elif</span> sys<span style="color: #666666">.</span>version_info <span style="color: #666666">&gt;=</span> (<span style="color: #666666">3</span>, <span style="color: #666666">10</span>):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">else</span>:
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: C) <span style="color: #666666">-&gt;</span> C: <span style="color: #666666">...</span>

<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: D) <span style="color: #666666">-&gt;</span> D: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any:
    <span style="color: #008000; font-weight: bold">return</span> var


reveal_type(func(B()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;B&quot;</span>
reveal_type(func(C()))  <span style="color: #3D7B7B; font-style: italic"># No overload variant of &quot;func&quot; matches argument type &quot;C&quot;</span>
    <span style="color: #3D7B7B; font-style: italic"># Possible overload variants:</span>
    <span style="color: #3D7B7B; font-style: italic">#     def func(var: B) -&gt; B</span>
    <span style="color: #3D7B7B; font-style: italic">#     def func(var: D) -&gt; D</span>
    <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Any&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>In the last example, mypy is executed with <a href="https://mypy.readthedocs.io/en/stable/command_line.html#cmdoption-mypy-python-version"><code>--python-version 3.10</code></a>.</p>
<p>Therefore, the condition <code>sys.version_info &gt;= (3, 10)</code> will match and the overload for <code>B</code> will be added.</p>
<p>The overloads for <code>A</code> and <code>C</code> are ignored!</p>
<p>The overload for <code>D</code> is not defined conditionally and thus is also added.</p>
</div>
<p>When mypy cannot infer a condition to be always <code>True</code> or always <code>False</code>, an error is emitted.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Any, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">A</span>: <span style="color: #666666">...</span>
<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">B</span>: <span style="color: #666666">...</span>


<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">g</span>(bool_var: <span style="color: #008000">bool</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> bool_var:  <span style="color: #3D7B7B; font-style: italic"># Condition can&#39;t be inferred, unable to merge overloads</span>
        <span style="color: #AA22FF">@overload</span>
        <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: A) <span style="color: #666666">-&gt;</span> A: <span style="color: #666666">...</span>

        <span style="color: #AA22FF">@overload</span>
        <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: B) <span style="color: #666666">-&gt;</span> B: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(var: Any) <span style="color: #666666">-&gt;</span> Any: <span style="color: #666666">...</span>

    reveal_type(func(A()))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Any&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="self类型的高级用法">self类型的高级用法<a class="headerlink" href="#self类型的高级用法" title="Permanent link">&para;</a></h2>
<p>Advanced uses of self-types</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">中文</label><label for="__tabbed_10_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>通常，mypy 不需要为实例和类方法的第一个参数添加注释。 然而，对于某些编程模式，它们可能需要具有更精确的静态类型。</p>
</div>
<div class="tabbed-block">
<p>Normally, mypy doesn't require annotations for the first arguments of instance and class methods. However, they may be needed to have more precise static typing for certain programming patterns.</p>
</div>
</div>
</div>
<h3 id="泛型类中的受限方法">泛型类中的受限方法<a class="headerlink" href="#泛型类中的受限方法" title="Permanent link">&para;</a></h3>
<p>Restricted methods in generic classes</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:2"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">中文</label><label for="__tabbed_11_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>在泛型类中，某些方法可能只允许为类型参数的某些值调用：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Tag</span>(Generic[T]):
    item: T
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">uppercase_item</span>(<span style="color: #008000">self</span>: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>item<span style="color: #666666">.</span>upper()

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">label</span>(ti: Tag[<span style="color: #008000">int</span>], ts: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    ti<span style="color: #666666">.</span>uppercase_item()  <span style="color: #3D7B7B; font-style: italic"># E: Invalid self argument &quot;Tag[int]&quot; to attribute function</span>
                        <span style="color: #3D7B7B; font-style: italic"># &quot;uppercase_item&quot; with type &quot;Callable[[Tag[str]], str]&quot;</span>
    ts<span style="color: #666666">.</span>uppercase_item()  <span style="color: #3D7B7B; font-style: italic"># This is OK</span>
</code></pre></div>
<p>在类型参数本身是泛型的情况下，此模式还允许匹配嵌套类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>, covariant<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
S <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;S&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Storage</span>(Generic[T]):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, content: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>content <span style="color: #666666">=</span> content
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">first_chunk</span>(<span style="color: #008000">self</span>: Storage[Sequence[S]]) <span style="color: #666666">-&gt;</span> S:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>content[<span style="color: #666666">0</span>]

page: Storage[<span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]
page<span style="color: #666666">.</span>first_chunk()  <span style="color: #3D7B7B; font-style: italic"># OK, type is &quot;str&quot;</span>

Storage(<span style="color: #666666">0</span>)<span style="color: #666666">.</span>first_chunk()  <span style="color: #3D7B7B; font-style: italic"># Error: Invalid self argument &quot;Storage[int]&quot; to attribute function</span>
                        <span style="color: #3D7B7B; font-style: italic"># &quot;first_chunk&quot; with type &quot;Callable[[Storage[Sequence[S]]], S]&quot;</span>
</code></pre></div>
<p>最后，可以使用自身类型的重载来表达一些棘手方法的精确类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Tag</span>(Generic[T]):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>, converter: Callable[[T], <span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>, converter<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>item, <span style="color: #008000">str</span>):
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>item
        <span style="color: #008000; font-weight: bold">return</span> converter(<span style="color: #008000">self</span><span style="color: #666666">.</span>item)
</code></pre></div>
<p>特别是，在自类型上重载的 <a href="https://docs.python.org/3/reference/datamodel.html#object.__init__"><code>__init__</code></a> 方法可能有助于注释类型参数依赖的泛型类构造函数 以不平凡的方式了解构造函数参数，请参见例如 <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen"><code>Popen</code></a>。</p>
</div>
<div class="tabbed-block">
<p>In generic classes some methods may be allowed to be called only for certain values of type arguments:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Tag</span>(Generic[T]):
    item: T
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">uppercase_item</span>(<span style="color: #008000">self</span>: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>item<span style="color: #666666">.</span>upper()

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">label</span>(ti: Tag[<span style="color: #008000">int</span>], ts: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    ti<span style="color: #666666">.</span>uppercase_item()  <span style="color: #3D7B7B; font-style: italic"># E: Invalid self argument &quot;Tag[int]&quot; to attribute function</span>
                        <span style="color: #3D7B7B; font-style: italic"># &quot;uppercase_item&quot; with type &quot;Callable[[Tag[str]], str]&quot;</span>
    ts<span style="color: #666666">.</span>uppercase_item()  <span style="color: #3D7B7B; font-style: italic"># This is OK</span>
</code></pre></div>
<p>This pattern also allows matching on nested types in situations where the type argument is itself generic:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>, covariant<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">True</span>)
S <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;S&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Storage</span>(Generic[T]):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, content: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>content <span style="color: #666666">=</span> content
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">first_chunk</span>(<span style="color: #008000">self</span>: Storage[Sequence[S]]) <span style="color: #666666">-&gt;</span> S:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>content[<span style="color: #666666">0</span>]

page: Storage[<span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]
page<span style="color: #666666">.</span>first_chunk()  <span style="color: #3D7B7B; font-style: italic"># OK, type is &quot;str&quot;</span>

Storage(<span style="color: #666666">0</span>)<span style="color: #666666">.</span>first_chunk()  <span style="color: #3D7B7B; font-style: italic"># Error: Invalid self argument &quot;Storage[int]&quot; to attribute function</span>
                        <span style="color: #3D7B7B; font-style: italic"># &quot;first_chunk&quot; with type &quot;Callable[[Storage[Sequence[S]]], S]&quot;</span>
</code></pre></div>
<p>Finally, one can use overloads on self-type to express precise types of some tricky methods:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Tag</span>(Generic[T]):
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>: Tag[<span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>
    <span style="color: #AA22FF">@overload</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>, converter: Callable[[T], <span style="color: #008000">str</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>: <span style="color: #666666">...</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">export</span>(<span style="color: #008000">self</span>, converter<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">None</span>):
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(<span style="color: #008000">self</span><span style="color: #666666">.</span>item, <span style="color: #008000">str</span>):
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>item
        <span style="color: #008000; font-weight: bold">return</span> converter(<span style="color: #008000">self</span><span style="color: #666666">.</span>item)
</code></pre></div>
<p>In particular, an <a href="https://docs.python.org/3/reference/datamodel.html#object.__init__"><code>__init__</code></a> method overloaded on self-type may be useful to annotate generic class constructors where type arguments depend on constructor parameters in a non-trivial way, see e.g. <a href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen"><code>Popen</code></a>.</p>
</div>
</div>
</div>
<h3 id="mixin-类">Mixin 类<a class="headerlink" href="#mixin-类" title="Permanent link">&para;</a></h3>
<p>Mixin classes</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">中文</label><label for="__tabbed_12_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>在 mixin 方法中使用主机类协议作为自类型可以为 mixin 类的静态类型提供更多的代码可重用性。 例如，可以定义一个协议来定义主机类的通用功能，而不是向每个 mixin 添加所需的抽象方法：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Lockable</span>(Protocol):
    <span style="color: #AA22FF">@property</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">lock</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> Lock: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AtomicCloseMixin</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">atomic_close</span>(<span style="color: #008000">self</span>: Lockable) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>lock:
            <span style="color: #3D7B7B; font-style: italic"># perform actions</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AtomicOpenMixin</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">atomic_open</span>(<span style="color: #008000">self</span>: Lockable) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>lock:
            <span style="color: #3D7B7B; font-style: italic"># perform actions</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">File</span>(AtomicCloseMixin, AtomicOpenMixin):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>lock <span style="color: #666666">=</span> Lock()

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Bad</span>(AtomicCloseMixin):
    <span style="color: #008000; font-weight: bold">pass</span>

f <span style="color: #666666">=</span> File()
b: Bad
f<span style="color: #666666">.</span>atomic_close()  <span style="color: #3D7B7B; font-style: italic"># OK</span>
b<span style="color: #666666">.</span>atomic_close()  <span style="color: #3D7B7B; font-style: italic"># Error: Invalid self type for &quot;atomic_close&quot;</span>
</code></pre></div>
<p>请注意，只要显式自类型不是当前类的超类型，就<em>必须</em>成为协议。 在这种情况下，mypy 将仅在调用站点检查自我类型的有效性。</p>
</div>
<div class="tabbed-block">
<p>Using host class protocol as a self-type in mixin methods allows more code re-usability for static typing of mixin classes. For example, one can define a protocol that defines common functionality for host classes instead of adding required abstract methods to every mixin:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Lockable</span>(Protocol):
    <span style="color: #AA22FF">@property</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">lock</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> Lock: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AtomicCloseMixin</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">atomic_close</span>(<span style="color: #008000">self</span>: Lockable) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>lock:
            <span style="color: #3D7B7B; font-style: italic"># perform actions</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AtomicOpenMixin</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">atomic_open</span>(<span style="color: #008000">self</span>: Lockable) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>lock:
            <span style="color: #3D7B7B; font-style: italic"># perform actions</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">File</span>(AtomicCloseMixin, AtomicOpenMixin):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>lock <span style="color: #666666">=</span> Lock()

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Bad</span>(AtomicCloseMixin):
    <span style="color: #008000; font-weight: bold">pass</span>

f <span style="color: #666666">=</span> File()
b: Bad
f<span style="color: #666666">.</span>atomic_close()  <span style="color: #3D7B7B; font-style: italic"># OK</span>
b<span style="color: #666666">.</span>atomic_close()  <span style="color: #3D7B7B; font-style: italic"># Error: Invalid self type for &quot;atomic_close&quot;</span>
</code></pre></div>
<p>Note that the explicit self-type is <em>required</em> to be a protocol whenever it is not a supertype of the current class. In this case mypy will check the validity of the self-type only at the call site.</p>
</div>
</div>
</div>
<h3 id="替代构造函数的精确类型">替代构造函数的精确类型<a class="headerlink" href="#替代构造函数的精确类型" title="Permanent link">&para;</a></h3>
<p>Precise typing of alternative constructors</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:2"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><input id="__tabbed_13_2" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">中文</label><label for="__tabbed_13_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>某些类可能定义替代构造函数。 如果这些类是通用的，则自类型允许为它们提供精确的签名：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Base</span>(Generic[T]):
    Q <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;Q&#39;</span>, bound<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Base[T]&#39;</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, item: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>item <span style="color: #666666">=</span> item

    <span style="color: #AA22FF">@classmethod</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">make_pair</span>(<span style="color: #008000">cls</span>: Type[Q], item: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000">tuple</span>[Q, Q]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">cls</span>(item), <span style="color: #008000">cls</span>(item)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Sub</span>(Base[T]):
    <span style="color: #666666">...</span>

pair <span style="color: #666666">=</span> Sub<span style="color: #666666">.</span>make_pair(<span style="color: #BA2121">&#39;yes&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># Type is &quot;tuple[Sub[str], Sub[str]]&quot;</span>
bad <span style="color: #666666">=</span> Sub[<span style="color: #008000">int</span>]<span style="color: #666666">.</span>make_pair(<span style="color: #BA2121">&#39;no&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: Argument 1 to &quot;make_pair&quot; of &quot;Base&quot;</span>
                                <span style="color: #3D7B7B; font-style: italic"># has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Some classes may define alternative constructors. If these
classes are generic, self-type allows giving them precise signatures:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;T&#39;</span>)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Base</span>(Generic[T]):
    Q <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&#39;Q&#39;</span>, bound<span style="color: #666666">=</span><span style="color: #BA2121">&#39;Base[T]&#39;</span>)

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, item: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>item <span style="color: #666666">=</span> item

    <span style="color: #AA22FF">@classmethod</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">make_pair</span>(<span style="color: #008000">cls</span>: Type[Q], item: T) <span style="color: #666666">-&gt;</span> <span style="color: #008000">tuple</span>[Q, Q]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">cls</span>(item), <span style="color: #008000">cls</span>(item)

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Sub</span>(Base[T]):
    <span style="color: #666666">...</span>

pair <span style="color: #666666">=</span> Sub<span style="color: #666666">.</span>make_pair(<span style="color: #BA2121">&#39;yes&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># Type is &quot;tuple[Sub[str], Sub[str]]&quot;</span>
bad <span style="color: #666666">=</span> Sub[<span style="color: #008000">int</span>]<span style="color: #666666">.</span>make_pair(<span style="color: #BA2121">&#39;no&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: Argument 1 to &quot;make_pair&quot; of &quot;Base&quot;</span>
                                <span style="color: #3D7B7B; font-style: italic"># has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="异步同步的类型检查">异步/同步的类型检查<a class="headerlink" href="#异步同步的类型检查" title="Permanent link">&para;</a></h2>
<p>Typing async/await</p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:2"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><input id="__tabbed_14_2" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">中文</label><label for="__tabbed_14_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 允许您输入使用“async/await”语法的协程。 有关协程的更多信息，请参阅 <a href="https://peps.python.org/pep-0492/"><code>PEP - 492</code></a> 和 <a href="https://docs.python.org/3/library/asyncio.html">asyncio 文档</a>。</p>
<p>使用“async def”定义的函数的类型与普通函数类似。 返回类型注释应该与您希望在“await”协程时返回的值的类型相同。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">format_string</span>(tag: <span style="color: #008000">str</span>, count: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">f&#39;T-minus </span><span style="color: #A45A77; font-weight: bold">{</span>count<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121"> (</span><span style="color: #A45A77; font-weight: bold">{</span>tag<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">)&#39;</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">countdown</span>(tag: <span style="color: #008000">str</span>, count: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">while</span> count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
        my_str <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">await</span> format_string(tag, count)  <span style="color: #3D7B7B; font-style: italic"># type is inferred to be str</span>
        <span style="color: #008000">print</span>(my_str)
        <span style="color: #008000; font-weight: bold">await</span> asyncio<span style="color: #666666">.</span>sleep(<span style="color: #666666">0.1</span>)
        count <span style="color: #666666">-=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;Blastoff!&quot;</span>

asyncio<span style="color: #666666">.</span>run(countdown(<span style="color: #BA2121">&quot;Millennium Falcon&quot;</span>, <span style="color: #666666">5</span>))
</code></pre></div>
<p>调用 <code>async def</code> 函数 <em>无需等待</em> 的结果将自动推断为 <a href="https://docs.python.org/3/library/typing.html#typing.Coroutine"><code>Coroutine[Any, Any, T]</code></a> 类型的值 ，它是 <a href="https://docs.python.org/3/library/typing.html#typing.Awaitable"><code>Awaitable[T]</code></a> 的子类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>my_coroutine <span style="color: #666666">=</span> countdown(<span style="color: #BA2121">&quot;Millennium Falcon&quot;</span>, <span style="color: #666666">5</span>)
reveal_type(my_coroutine)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.Coroutine[Any, Any, builtins.str]&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy lets you type coroutines that use the <code>async/await</code> syntax. For more information regarding coroutines, see <a href="https://peps.python.org/pep-0492/"><code>PEP - 492</code></a> and the <a href="https://docs.python.org/3/library/asyncio.html">asyncio documentation</a>.</p>
<p>Functions defined using <code>async def</code> are typed similar to normal functions. The return type annotation should be the same as the type of the value you expect to get back when <code>await</code>-ing the coroutine.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">format_string</span>(tag: <span style="color: #008000">str</span>, count: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">f&#39;T-minus </span><span style="color: #A45A77; font-weight: bold">{</span>count<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121"> (</span><span style="color: #A45A77; font-weight: bold">{</span>tag<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">)&#39;</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">countdown</span>(tag: <span style="color: #008000">str</span>, count: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">while</span> count <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>:
        my_str <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">await</span> format_string(tag, count)  <span style="color: #3D7B7B; font-style: italic"># type is inferred to be str</span>
        <span style="color: #008000">print</span>(my_str)
        <span style="color: #008000; font-weight: bold">await</span> asyncio<span style="color: #666666">.</span>sleep(<span style="color: #666666">0.1</span>)
        count <span style="color: #666666">-=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;Blastoff!&quot;</span>

asyncio<span style="color: #666666">.</span>run(countdown(<span style="color: #BA2121">&quot;Millennium Falcon&quot;</span>, <span style="color: #666666">5</span>))
</code></pre></div>
<p>The result of calling an <code>async def</code> function <em>without awaiting</em> will automatically be inferred to be a value of type <a href="https://docs.python.org/3/library/typing.html#typing.Coroutine"><code>Coroutine[Any, Any, T]</code></a>, which is a subtype of <a href="https://docs.python.org/3/library/typing.html#typing.Awaitable"><code>Awaitable[T]</code></a>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>my_coroutine <span style="color: #666666">=</span> countdown(<span style="color: #BA2121">&quot;Millennium Falcon&quot;</span>, <span style="color: #666666">5</span>)
reveal_type(my_coroutine)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.Coroutine[Any, Any, builtins.str]&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="异步迭代器">异步迭代器<a class="headerlink" href="#异步迭代器" title="Permanent link">&para;</a></h3>
<p>Asynchronous iterators</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:2"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><input id="__tabbed_15_2" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">中文</label><label for="__tabbed_15_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>如果您有异步迭代器，则可以在注释中使用 <a href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator"><code>AsyncIterator</code></a> 类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Optional, AsyncIterator
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">arange</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, start: <span style="color: #008000">int</span>, stop: <span style="color: #008000">int</span>, step: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>start <span style="color: #666666">=</span> start
        <span style="color: #008000">self</span><span style="color: #666666">.</span>stop <span style="color: #666666">=</span> stop
        <span style="color: #008000">self</span><span style="color: #666666">.</span>step <span style="color: #666666">=</span> step
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> start <span style="color: #666666">-</span> step

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__aiter__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span>

    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__anext__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>step
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">==</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>stop:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">StopAsyncIteration</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">run_countdown</span>(tag: <span style="color: #008000">str</span>, countdown: AsyncIterator[<span style="color: #008000">int</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> countdown:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">f&#39;T-minus </span><span style="color: #A45A77; font-weight: bold">{</span>i<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121"> (</span><span style="color: #A45A77; font-weight: bold">{</span>tag<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">)&#39;</span>)
        <span style="color: #008000; font-weight: bold">await</span> asyncio<span style="color: #666666">.</span>sleep(<span style="color: #666666">0.1</span>)
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;Blastoff!&quot;</span>

asyncio<span style="color: #666666">.</span>run(run_countdown(<span style="color: #BA2121">&quot;Serenity&quot;</span>, arange(<span style="color: #666666">5</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-1</span>)))
</code></pre></div>
<p>异步生成器（在 <a href="https://peps.python.org/pep-0525/"><code>PEP 525</code></a> 中引入）是创建异步迭代器的简单方法：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncGenerator, Optional
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #3D7B7B; font-style: italic"># 也可以输入此作为返回 AsyncIterator[int]</span>
<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">arange</span>(start: <span style="color: #008000">int</span>, stop: <span style="color: #008000">int</span>, step: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncGenerator[<span style="color: #008000">int</span>, <span style="color: #008000; font-weight: bold">None</span>]:
    current <span style="color: #666666">=</span> start
    <span style="color: #008000; font-weight: bold">while</span> (step <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> current <span style="color: #666666">&lt;</span> stop) <span style="color: #AA22FF; font-weight: bold">or</span> (step <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> current <span style="color: #666666">&gt;</span> stop):
        <span style="color: #008000; font-weight: bold">yield</span> current
        current <span style="color: #666666">+=</span> step

asyncio<span style="color: #666666">.</span>run(run_countdown(<span style="color: #BA2121">&quot;Battlestar Galactica&quot;</span>, arange(<span style="color: #666666">5</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-1</span>)))
</code></pre></div>
<p>一个常见的混淆是“async def”函数中“yield”语句的存在会影响函数的类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncIterator

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">arange</span>(stop: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># 调用时，arange 为您提供一个异步迭代器，相当于 Callable[[int], AsyncIterator[int]]</span>
    i <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    <span style="color: #008000; font-weight: bold">while</span> i <span style="color: #666666">&lt;</span> stop:
        <span style="color: #008000; font-weight: bold">yield</span> i
        i <span style="color: #666666">+=</span> <span style="color: #666666">1</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">coroutine</span>(stop: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># 调用时，协程会为您提供一些可以等待以获得异步迭代器的东西，相当于 Callable[[int], Coroutine[Any, Any, AsyncIterator[int]]]</span>
    <span style="color: #008000; font-weight: bold">return</span> arange(stop)

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    reveal_type(arange(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
    reveal_type(coroutine(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.Coroutine[Any, Any, typing.AsyncIterator[builtins.int]]&quot;</span>

    <span style="color: #008000; font-weight: bold">await</span> arange(<span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: Incompatible types in &quot;await&quot; (actual type &quot;AsyncIterator[int]&quot;, expected type &quot;Awaitable[Any]&quot;)</span>
    reveal_type(<span style="color: #008000; font-weight: bold">await</span> coroutine(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
</code></pre></div>
<p>当尝试定义基类、协议或重载时，有时会出现这种情况：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncIterator, Protocol, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherIncorrect</span>(Protocol):
    <span style="color: #3D7B7B; font-style: italic"># 因为 launch 没有 Yield，所以它的类型为 Callable[[], Coroutine[Any, Any, AsyncIterator[int]]] 而不是 Callable[[], AsyncIterator[int]]</span>
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherCorrect</span>(Protocol):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherAlsoCorrect</span>(Protocol):
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000; font-weight: bold">False</span>:
            <span style="color: #008000; font-weight: bold">yield</span> <span style="color: #666666">0</span>

<span style="color: #3D7B7B; font-style: italic"># 重载的类型与实现无关。</span>
<span style="color: #3D7B7B; font-style: italic"># 特别是，它们的类型不受实现是否包含“yield”的影响。</span>
<span style="color: #3D7B7B; font-style: italic"># 使用 `def` 可以清楚地表明类型是 Callable[..., AsyncIterator[int]]，</span>
<span style="color: #3D7B7B; font-style: italic"># 而使用 `async def` 它将是 Callable[..., Coroutine[Any, Any, AsyncIterator[int]]]</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, count: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, time: <span style="color: #008000">float</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, count: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>, time: <span style="color: #008000">float</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># launch 的实现是一个异步生成器并包含一个yield</span>
    <span style="color: #008000; font-weight: bold">yield</span> <span style="color: #666666">0</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>If you have an asynchronous iterator, you can use the <a href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator"><code>AsyncIterator</code></a> type in your annotations:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Optional, AsyncIterator
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">arange</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, start: <span style="color: #008000">int</span>, stop: <span style="color: #008000">int</span>, step: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>start <span style="color: #666666">=</span> start
        <span style="color: #008000">self</span><span style="color: #666666">.</span>stop <span style="color: #666666">=</span> stop
        <span style="color: #008000">self</span><span style="color: #666666">.</span>step <span style="color: #666666">=</span> step
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">=</span> start <span style="color: #666666">-</span> step

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__aiter__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span>

    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__anext__</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">+=</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>step
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count <span style="color: #666666">==</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>stop:
            <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">StopAsyncIteration</span>
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>count

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">run_countdown</span>(tag: <span style="color: #008000">str</span>, countdown: AsyncIterator[<span style="color: #008000">int</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">str</span>:
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> countdown:
        <span style="color: #008000">print</span>(<span style="color: #BA2121">f&#39;T-minus </span><span style="color: #A45A77; font-weight: bold">{</span>i<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121"> (</span><span style="color: #A45A77; font-weight: bold">{</span>tag<span style="color: #A45A77; font-weight: bold">}</span><span style="color: #BA2121">)&#39;</span>)
        <span style="color: #008000; font-weight: bold">await</span> asyncio<span style="color: #666666">.</span>sleep(<span style="color: #666666">0.1</span>)
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #BA2121">&quot;Blastoff!&quot;</span>

asyncio<span style="color: #666666">.</span>run(run_countdown(<span style="color: #BA2121">&quot;Serenity&quot;</span>, arange(<span style="color: #666666">5</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-1</span>)))
</code></pre></div>
<p>Async generators (introduced in <a href="https://peps.python.org/pep-0525/"><code>PEP 525</code></a>) are an easy way to create async iterators:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncGenerator, Optional
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">asyncio</span>

<span style="color: #3D7B7B; font-style: italic"># Could also type this as returning AsyncIterator[int]</span>
<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">arange</span>(start: <span style="color: #008000">int</span>, stop: <span style="color: #008000">int</span>, step: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncGenerator[<span style="color: #008000">int</span>, <span style="color: #008000; font-weight: bold">None</span>]:
    current <span style="color: #666666">=</span> start
    <span style="color: #008000; font-weight: bold">while</span> (step <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> current <span style="color: #666666">&lt;</span> stop) <span style="color: #AA22FF; font-weight: bold">or</span> (step <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span> <span style="color: #AA22FF; font-weight: bold">and</span> current <span style="color: #666666">&gt;</span> stop):
        <span style="color: #008000; font-weight: bold">yield</span> current
        current <span style="color: #666666">+=</span> step

asyncio<span style="color: #666666">.</span>run(run_countdown(<span style="color: #BA2121">&quot;Battlestar Galactica&quot;</span>, arange(<span style="color: #666666">5</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-1</span>)))
</code></pre></div>
<p>One common confusion is that the presence of a <code>yield</code> statement in an
<code>async def</code> function has an effect on the type of the function:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncIterator

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">arange</span>(stop: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># When called, arange gives you an async iterator</span>
    <span style="color: #3D7B7B; font-style: italic"># Equivalent to Callable[[int], AsyncIterator[int]]</span>
    i <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    <span style="color: #008000; font-weight: bold">while</span> i <span style="color: #666666">&lt;</span> stop:
        <span style="color: #008000; font-weight: bold">yield</span> i
        i <span style="color: #666666">+=</span> <span style="color: #666666">1</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">coroutine</span>(stop: <span style="color: #008000">int</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># When called, coroutine gives you something you can await to get an async iterator</span>
    <span style="color: #3D7B7B; font-style: italic"># Equivalent to Callable[[int], Coroutine[Any, Any, AsyncIterator[int]]]</span>
    <span style="color: #008000; font-weight: bold">return</span> arange(stop)

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>() <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    reveal_type(arange(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
    reveal_type(coroutine(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.Coroutine[Any, Any, typing.AsyncIterator[builtins.int]]&quot;</span>

    <span style="color: #008000; font-weight: bold">await</span> arange(<span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: Incompatible types in &quot;await&quot; (actual type &quot;AsyncIterator[int]&quot;, expected type &quot;Awaitable[Any]&quot;)</span>
    reveal_type(<span style="color: #008000; font-weight: bold">await</span> coroutine(<span style="color: #666666">5</span>))  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
</code></pre></div>
<p>This can sometimes come up when trying to define base classes, Protocols or overloads:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> AsyncIterator, Protocol, overload

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherIncorrect</span>(Protocol):
    <span style="color: #3D7B7B; font-style: italic"># Because launch does not have yield, this has type</span>
    <span style="color: #3D7B7B; font-style: italic"># Callable[[], Coroutine[Any, Any, AsyncIterator[int]]]</span>
    <span style="color: #3D7B7B; font-style: italic"># instead of</span>
    <span style="color: #3D7B7B; font-style: italic"># Callable[[], AsyncIterator[int]]</span>
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherCorrect</span>(Protocol):
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">LauncherAlsoCorrect</span>(Protocol):
    <span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #CB3F38; font-weight: bold">NotImplementedError</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000; font-weight: bold">False</span>:
            <span style="color: #008000; font-weight: bold">yield</span> <span style="color: #666666">0</span>

<span style="color: #3D7B7B; font-style: italic"># The type of the overloads is independent of the implementation.</span>
<span style="color: #3D7B7B; font-style: italic"># In particular, their type is not affected by whether or not the</span>
<span style="color: #3D7B7B; font-style: italic"># implementation contains a `yield`.</span>
<span style="color: #3D7B7B; font-style: italic"># Use of `def`` makes it clear the type is Callable[..., AsyncIterator[int]],</span>
<span style="color: #3D7B7B; font-style: italic"># whereas with `async def` it would be Callable[..., Coroutine[Any, Any, AsyncIterator[int]]]</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, count: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]: <span style="color: #666666">...</span>
<span style="color: #AA22FF">@overload</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, time: <span style="color: #008000">float</span> <span style="color: #666666">=</span> <span style="color: #666666">...</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]: <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">async</span> <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">launch</span>(<span style="color: #666666">*</span>, count: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>, time: <span style="color: #008000">float</span> <span style="color: #666666">=</span> <span style="color: #666666">0</span>) <span style="color: #666666">-&gt;</span> AsyncIterator[<span style="color: #008000">int</span>]:
    <span style="color: #3D7B7B; font-style: italic"># The implementation of launch is an async generator and contains a yield</span>
    <span style="color: #008000; font-weight: bold">yield</span> <span style="color: #666666">0</span>
</code></pre></div>
</div>
</div>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "content.tabs.link", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.prune", "navigation.instant"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>