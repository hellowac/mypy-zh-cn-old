
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="hellowac-类型检查">
      
      
      
      
        <link rel="prev" href="../dynamic_typing/">
      
      
        <link rel="next" href="../duck_type_compatibility/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>类型收缩 - mypy类型检查</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="blue">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#类型收缩" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
你当前浏览的版本已不是最新版本，
<a href="../../..">
    <strong>点击这里</strong>
</a>查看最新版本的文档

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="mypy类型检查" class="md-header__button md-logo" aria-label="mypy类型检查" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mypy类型检查
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              类型收缩
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  欢迎来到mypy文档!

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../" class="md-tabs__link">
          
  
    
  
  第一步

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../builtin_types/" class="md-tabs__link">
          
  
    
  
  类型系统参考

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_conf/" class="md-tabs__link">
          
  
    
  
  配置和运行mypy

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_other/" class="md-tabs__link">
          
  
    
  
  其他杂项

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mypy类型检查" class="md-nav__button md-logo" aria-label="mypy类型检查" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    mypy类型检查
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欢迎来到mypy文档!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    第一步
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            第一步
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../cheat_sheet_py3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型提示备忘录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../existing_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    将 mypy 与现有代码库结合使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    类型系统参考
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            类型系统参考
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../builtin_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内置类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../type_inference_type_annotations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型推断和类型注解
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../kind_of_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型种类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../class_basics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类的基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../annotation_issue_at_runtime/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行时的注解问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../protocol_and_struct_subtyping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    协议及其子类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_typing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    动态类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    类型收缩
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    类型收缩
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#类型收缩表达式" class="md-nav__link">
    类型收缩表达式
  </a>
  
    <nav class="md-nav" aria-label="类型收缩表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#是否为子类" class="md-nav__link">
    是否为子类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#是否可调用" class="md-nav__link">
    是否可调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#转换" class="md-nav__link">
    转换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#用户定义的类型保护" class="md-nav__link">
    用户定义的类型保护
  </a>
  
    <nav class="md-nav" aria-label="用户定义的类型保护">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#泛型类型保护" class="md-nav__link">
    泛型类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#带参数的类型保护" class="md-nav__link">
    带参数的类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#作为方法的类型保护" class="md-nav__link">
    作为方法的类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#作为类型保护的赋值表达式" class="md-nav__link">
    作为类型保护的赋值表达式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../duck_type_compatibility/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    鸭子类型兼容
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../stub_files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存根文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../generics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    泛型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../more_types/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    更多类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../literal_and_enum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    字面量和枚举
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../typeddict/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    类型字典
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../final_names_methods_classes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    最终名称、方法和类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../metaclasses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    元类
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_conf/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    配置和运行mypy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            配置和运行mypy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/running_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行mypy和管理导入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/command_line/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy命令行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/config_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy配置文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/inline_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内联配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/mypy_daemon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy服务(守护进程)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/installed_packages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用安装包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/extending_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扩展和集成 mypy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/stubgen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_conf/stubtest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根测试
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../mypy_other/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    其他杂项
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            其他杂项
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/common_issues/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题及解决办法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/supported_python_features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    支持的 Python 特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_codes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_code_list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    默认启用的错误码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/error_code_list2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可选检查的错误代码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/additional_features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    额外特性
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常见问题解答
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/python/mypy" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    项目地址
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://mypy-lang.org/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    网页地址
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#类型收缩表达式" class="md-nav__link">
    类型收缩表达式
  </a>
  
    <nav class="md-nav" aria-label="类型收缩表达式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#是否为子类" class="md-nav__link">
    是否为子类
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#是否可调用" class="md-nav__link">
    是否可调用
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#转换" class="md-nav__link">
    转换
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#用户定义的类型保护" class="md-nav__link">
    用户定义的类型保护
  </a>
  
    <nav class="md-nav" aria-label="用户定义的类型保护">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#泛型类型保护" class="md-nav__link">
    泛型类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#带参数的类型保护" class="md-nav__link">
    带参数的类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#作为方法的类型保护" class="md-nav__link">
    作为方法的类型保护
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#作为类型保护的赋值表达式" class="md-nav__link">
    作为类型保护的赋值表达式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="类型收缩">类型收缩<a class="headerlink" href="#类型收缩" title="Permanent link">&para;</a></h1>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>本节专门介绍 mypy 支持的几种类型收缩技术。</p>
<p>类型缩小是指您让类型检查器相信更广泛的类型实际上更具体，例如，<code>Shape</code> 类型的对象实际上是更窄的 <code>Square</code> 类型。</p>
</div>
<div class="tabbed-block">
<p><strong>Type narrowing</strong></p>
<p>This section is dedicated to  several type narrowing techniques which are supported by mypy.</p>
<p>Type narrowing is when you convince a type checker that a broader type is actually more specific, for instance, that an object of type <code>Shape</code> is actually of the narrower type <code>Square</code>.</p>
</div>
</div>
</div>
<h2 id="类型收缩表达式">类型收缩表达式<a class="headerlink" href="#类型收缩表达式" title="Permanent link">&para;</a></h2>
<p>Type narrowing expressions</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>缩小类型范围的最简单方法是使用受支持的表达式之一：</p>
<ul>
<li><a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> 就像 <code>isinstance(obj, float)</code> 会将 <code>obj</code> 缩小为 <code>float</code> 类型</li>
<li><a href="https://docs.python.org/3/library/functions.html#issubclass"><code>issubclass</code></a> 就像 <code>issubclass(cls, MyClass)</code> 会将<code>cls</code> 缩小为 <code>Type[MyClass]</code> 类型</li>
<li><a href="https://docs.python.org/3/library/functions.html#type"><code>type</code></a> 就像 <code>type(obj) is int</code> 会将 <code>obj</code> 缩小为 <code>int</code> 类型</li>
<li><a href="https://docs.python.org/3/library/functions.html#callable"><code>callable</code></a> 就像 <code>callable(obj)</code> 将对象缩小为可调用类型</li>
</ul>
<p>类型缩小是根据上下文而定的。 例如，根据条件，mypy 将仅在<code>if</code>分支内缩小表达式：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>):
        <span style="color: #3D7B7B; font-style: italic"># 类型仅在“if”分支内缩小</span>
        reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型：“builtins.int”</span>
    <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">str</span>) <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">bool</span>):
        <span style="color: #3D7B7B; font-style: italic"># 在这个 elif 分支中，类型以不同的方式缩小：</span>
        reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型：“builtins.str |builtins.bool”</span>

        <span style="color: #3D7B7B; font-style: italic"># 后续的缩小操作将进一步缩小类型</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">bool</span>):
            reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型: &quot;builtins.bool&quot;</span>

    <span style="color: #3D7B7B; font-style: italic"># 回到“if”语句之外，类型没有缩小：</span>
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型: &quot;builtins.object&quot;</span>
</code></pre></div>
<p>Mypy 理解<code>return</code>或异常引发对对象类型的影响：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">int</span> <span style="color: #666666">|</span> <span style="color: #008000">str</span>):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>):
        <span style="color: #008000; font-weight: bold">return</span>

    <span style="color: #3D7B7B; font-style: italic"># 此时 `arg` 不能是 `int`：</span>
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型: &quot;builtins.str&quot;</span>
</code></pre></div>
<p>我们还可以使用<code>assert</code>来缩小相同上下文中的类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: Any):
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>)
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># 显示类型: &quot;builtins.int&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>使用 <a href="https://mypy.readthedocs.io/en/latest/command_line.html#cmdoption-mypy-warn-unreachable"><code>--warn-unreachable</code></a> 将类型缩小到某些不可能的状态将被视为错误。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">int</span>):
    <span style="color: #3D7B7B; font-style: italic"># error: “int”和“str”的子类不能存在：</span>
    <span style="color: #3D7B7B; font-style: italic"># 会有不兼容的方法签名</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">str</span>)

    <span style="color: #3D7B7B; font-style: italic"># error: 声明无法访问(Statement is unreachable)</span>
    <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;so mypy concludes the assert will always trigger&quot;</span>)
</code></pre></div>
<p>如果没有<code>--warn-unreachable</code>，mypy 将不会检查它认为无法访问的代码。 有关更多信息，请参阅<a href="https://mypy.readthedocs.io/en/latest/common_issues.html#unreachable"><code>无法访问的代码</code></a>。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>x: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>)
reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># 显示类型 &quot;builtins.int&quot;</span>
<span style="color: #008000">print</span>(x <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;!&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># 使用`mypy`进行类型检查，但在运行时失败。</span>
</code></pre></div>
</div>
</div>
<div class="tabbed-block">
<p>The simplest way to narrow a type is to use one of the supported expressions:</p>
<ul>
<li><a href="https://docs.python.org/3/library/functions.html#isinstance"><code>isinstance</code></a> like in <code>isinstance(obj, float)</code> will narrow <code>obj</code> to have <code>float</code> type</li>
<li><a href="https://docs.python.org/3/library/functions.html#issubclass"><code>issubclass</code></a> like in <code>issubclass(cls, MyClass)</code> will narrow <code>cls</code> to be <code>Type[MyClass]</code></li>
<li><a href="https://docs.python.org/3/library/functions.html#type"><code>type</code></a> like in <code>type(obj) is int</code> will narrow <code>obj</code> to have <code>int</code> type</li>
<li><a href="https://docs.python.org/3/library/functions.html#callable"><code>callable</code></a> like in <code>callable(obj)</code> will narrow object to callable type</li>
</ul>
<p>Type narrowing is contextual. For example, based on the condition, mypy will narrow an expression only within an <code>if</code> branch:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">object</span>):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>):
        <span style="color: #3D7B7B; font-style: italic"># Type is narrowed within the ``if`` branch only</span>
        reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.int&quot;</span>
    <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">str</span>) <span style="color: #AA22FF; font-weight: bold">or</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">bool</span>):
        <span style="color: #3D7B7B; font-style: italic"># Type is narrowed differently within this ``elif`` branch:</span>
        reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.str | builtins.bool&quot;</span>

        <span style="color: #3D7B7B; font-style: italic"># Subsequent narrowing operations will narrow the type further</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">bool</span>):
            reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.bool&quot;</span>

    <span style="color: #3D7B7B; font-style: italic"># Back outside of the ``if`` statement, the type isn&#39;t narrowed:</span>
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.object&quot;</span>
</code></pre></div>
<p>Mypy understands the implications <code>return</code> or exception raising can have
for what type an object could be:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">int</span> <span style="color: #666666">|</span> <span style="color: #008000">str</span>):
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>):
        <span style="color: #008000; font-weight: bold">return</span>

    <span style="color: #3D7B7B; font-style: italic"># `arg` can&#39;t be `int` at this point:</span>
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.str&quot;</span>
</code></pre></div>
<p>We can also use <code>assert</code> to narrow types in the same context:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: Any):
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">int</span>)
    reveal_type(arg)  <span style="color: #3D7B7B; font-style: italic"># Revealed type: &quot;builtins.int&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>With <a href="https://mypy.readthedocs.io/en/latest/command_line.html#cmdoption-mypy-warn-unreachable"><code>--warn-unreachable</code></a> narrowing types to some impossible state will be treated as an error.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">function</span>(arg: <span style="color: #008000">int</span>):
    <span style="color: #3D7B7B; font-style: italic"># error: Subclass of &quot;int&quot; and &quot;str&quot; cannot exist:</span>
    <span style="color: #3D7B7B; font-style: italic"># would have incompatible method signatures</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(arg, <span style="color: #008000">str</span>)

    <span style="color: #3D7B7B; font-style: italic"># error: Statement is unreachable</span>
    <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot;so mypy concludes the assert will always trigger&quot;</span>)
</code></pre></div>
<p>Without <code>--warn-unreachable</code> mypy will simply not check code it deems to be unreachable. See <a href="https://mypy.readthedocs.io/en/latest/common_issues.html#unreachable"><code>unreachable code</code></a> for more information.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>x: <span style="color: #008000">int</span> <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>)
reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;builtins.int&quot;</span>
<span style="color: #008000">print</span>(x <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;!&#39;</span>)  <span style="color: #3D7B7B; font-style: italic"># Typechecks with `mypy`, but fails in runtime.</span>
</code></pre></div>
</div>
</div>
</div>
</div>
<h3 id="是否为子类">是否为子类<a class="headerlink" href="#是否为子类" title="Permanent link">&para;</a></h3>
<p>issubclass</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 还可以使用 <a href="https://docs.python.org/3/library/functions.html#issubclass"><code>issubclass</code></a> 在处理类型和元类时进行更好的类型推断：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyCalcMeta</span>(<span style="color: #008000">type</span>):
    <span style="color: #AA22FF">@classmethod</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">calc</span>(<span style="color: #008000">cls</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(o: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    t <span style="color: #666666">=</span> <span style="color: #008000">type</span>(o)  <span style="color: #3D7B7B; font-style: italic"># 我们必须在这里使用一个变量</span>
    reveal_type(t)  <span style="color: #3D7B7B; font-style: italic"># 揭示的类型是 &quot;builtins.type&quot;</span>

    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">issubclass</span>(t, MyCalcMeta):  <span style="color: #3D7B7B; font-style: italic"># `issubclass(type(o), MyCalcMeta)` 不起作用</span>
        reveal_type(t)  <span style="color: #3D7B7B; font-style: italic"># 揭示的类型是 &quot;Type[MyCalcMeta]&quot;</span>
        t<span style="color: #666666">.</span>calc()  <span style="color: #3D7B7B; font-style: italic"># Okay</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy can also use <a href="https://docs.python.org/3/library/functions.html#issubclass"><code>issubclass</code></a> for better type inference when working with types and metaclasses:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">MyCalcMeta</span>(<span style="color: #008000">type</span>):
    <span style="color: #AA22FF">@classmethod</span>
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">calc</span>(<span style="color: #008000">cls</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000">int</span>:
        <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(o: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    t <span style="color: #666666">=</span> <span style="color: #008000">type</span>(o)  <span style="color: #3D7B7B; font-style: italic"># We must use a variable here</span>
    reveal_type(t)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;builtins.type&quot;</span>

    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">issubclass</span>(t, MyCalcMeta):  <span style="color: #3D7B7B; font-style: italic"># `issubclass(type(o), MyCalcMeta)` won&#39;t work</span>
        reveal_type(t)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Type[MyCalcMeta]&quot;</span>
        t<span style="color: #666666">.</span>calc()  <span style="color: #3D7B7B; font-style: italic"># Okay</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="是否可调用">是否可调用<a class="headerlink" href="#是否可调用" title="Permanent link">&para;</a></h3>
<p>callable</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 在类型检查期间知道哪些类型可调用，哪些类型不可调用。 所以，我们知道 <code>callable()</code> 会返回什么。 例如：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Callable

x: Callable[[], <span style="color: #008000">int</span>]

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(x):
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: 揭示的类型是 &quot;def () -&gt; builtins.int&quot;</span>
<span style="color: #008000; font-weight: bold">else</span>:
    <span style="color: #666666">...</span>  <span style="color: #3D7B7B; font-style: italic"># 永远不会被执行并且会引发错误 `--warn-unreachable`</span>
</code></pre></div>
<p><a href="https://docs.python.org/3/library/functions.html#callable"><code>callable</code></a> 函数甚至可以将 <code>Union</code> 类型拆分为可调用部分和不可调用部分：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Callable, Union

x: Union[<span style="color: #008000">int</span>, Callable[[], <span style="color: #008000">int</span>]]

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(x):
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: 揭示的类型是 &quot;def () -&gt; builtins.int&quot;</span>
<span style="color: #008000; font-weight: bold">else</span>:
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: 揭示的类型是 &quot;builtins.int&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy knows what types are callable and which ones are not during type checking. So, we know what <code>callable()</code> will return. For example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Callable

x: Callable[[], <span style="color: #008000">int</span>]

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(x):
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &quot;def () -&gt; builtins.int&quot;</span>
<span style="color: #008000; font-weight: bold">else</span>:
    <span style="color: #666666">...</span>  <span style="color: #3D7B7B; font-style: italic"># Will never be executed and will raise error with `--warn-unreachable`</span>
</code></pre></div>
<p><a href="https://docs.python.org/3/library/functions.html#callable"><code>callable</code></a> function can even split <code>Union</code> type for callable and non-callable parts:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Callable, Union

x: Union[<span style="color: #008000">int</span>, Callable[[], <span style="color: #008000">int</span>]]

<span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(x):
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &quot;def () -&gt; builtins.int&quot;</span>
<span style="color: #008000; font-weight: bold">else</span>:
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &quot;builtins.int&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="转换">转换<a class="headerlink" href="#转换" title="Permanent link">&para;</a></h2>
<p>Casts</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">中文</label><label for="__tabbed_5_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 支持类型转换，通常用于将静态类型值强制转换为子类型。 然而，与 Java 或 C# 等语言不同，mypy 强制转换仅用作类型检查器的提示，并且不执行运行时类型检查。 使用函数 <a href="https://docs.python.org/3/library/typing.html#typing.cast"><code>typing.cast</code></a> 执行转换：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> cast

o: <span style="color: #008000">object</span> <span style="color: #666666">=</span> [<span style="color: #666666">1</span>]
x <span style="color: #666666">=</span> cast(<span style="color: #008000">list</span>[<span style="color: #008000">int</span>], o)  <span style="color: #3D7B7B; font-style: italic"># OK</span>
y <span style="color: #666666">=</span> cast(<span style="color: #008000">list</span>[<span style="color: #008000">str</span>], o)  <span style="color: #3D7B7B; font-style: italic"># OK (强制转换不执行实际的运行时检查)</span>
</code></pre></div>
<p>为了支持上述类型转换的运行时检查，我们必须检查所有列表项的类型，这对于大型列表来说效率非常低。 强制转换用于消除虚假的类型检查器警告，并在类型检查器无法完全理解正在发生的情况时为类型检查器提供一些帮助。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>You can use an assertion if you want to perform an actual runtime check:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">foo</span>(o: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000">print</span>(o <span style="color: #666666">+</span> <span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: can&#39;t add &#39;object&#39; and &#39;int&#39;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(o, <span style="color: #008000">int</span>)
    <span style="color: #008000">print</span>(o <span style="color: #666666">+</span> <span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># OK: type of &#39;o&#39; is &#39;int&#39; here</span>
</code></pre></div>
</div>
<p>正如前面所解释的，您不需要对<code>Any</code>类型的表达式进行强制转换，或者在分配给类型为<code>Any</code>的变量时进行强制转换。 您还可以使用<code>Any</code>作为转换目标类型——这允许您对结果执行任何操作。 例如：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> cast, Any

x <span style="color: #666666">=</span> <span style="color: #666666">1</span>
x<span style="color: #666666">.</span>whatever()  <span style="color: #3D7B7B; font-style: italic"># Type check error</span>
y <span style="color: #666666">=</span> cast(Any, x)
y<span style="color: #666666">.</span>whatever()  <span style="color: #3D7B7B; font-style: italic"># Type check OK (runtime error)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Mypy supports type casts that are usually used to coerce a statically typed value to a subtype. Unlike languages such as Java or C#, however, mypy casts are only used as hints for the type checker, and they don't perform a runtime type check. Use the function <a href="https://docs.python.org/3/library/typing.html#typing.cast"><code>typing.cast</code></a> to perform a cast:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> cast

o: <span style="color: #008000">object</span> <span style="color: #666666">=</span> [<span style="color: #666666">1</span>]
x <span style="color: #666666">=</span> cast(<span style="color: #008000">list</span>[<span style="color: #008000">int</span>], o)  <span style="color: #3D7B7B; font-style: italic"># OK</span>
y <span style="color: #666666">=</span> cast(<span style="color: #008000">list</span>[<span style="color: #008000">str</span>], o)  <span style="color: #3D7B7B; font-style: italic"># OK (cast performs no actual runtime check)</span>
</code></pre></div>
<p>To support runtime checking of casts such as the above, we'd have to check the types of all list items, which would be very inefficient for large lists. Casts are used to silence spurious type checker warnings and give the type checker a little help when it can't quite understand what is going on.</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>You can use an assertion if you want to perform an actual runtime check:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">foo</span>(o: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000">print</span>(o <span style="color: #666666">+</span> <span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># Error: can&#39;t add &#39;object&#39; and &#39;int&#39;</span>
    <span style="color: #008000; font-weight: bold">assert</span> <span style="color: #008000">isinstance</span>(o, <span style="color: #008000">int</span>)
    <span style="color: #008000">print</span>(o <span style="color: #666666">+</span> <span style="color: #666666">5</span>)  <span style="color: #3D7B7B; font-style: italic"># OK: type of &#39;o&#39; is &#39;int&#39; here</span>
</code></pre></div>
</div>
<p>You don't need a cast for expressions with type <code>Any</code>, or when assigning to a variable with type <code>Any</code>, as was explained earlier. You can also use <code>Any</code> as the cast target type -- this lets you perform any operations on the result. For example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> cast, Any

x <span style="color: #666666">=</span> <span style="color: #666666">1</span>
x<span style="color: #666666">.</span>whatever()  <span style="color: #3D7B7B; font-style: italic"># Type check error</span>
y <span style="color: #666666">=</span> cast(Any, x)
y<span style="color: #666666">.</span>whatever()  <span style="color: #3D7B7B; font-style: italic"># Type check OK (runtime error)</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="用户定义的类型保护">用户定义的类型保护<a class="headerlink" href="#用户定义的类型保护" title="Permanent link">&para;</a></h2>
<p>User-Defined Type Guards</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">中文</label><label for="__tabbed_6_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Mypy 支持用户定义的类型防护 (<a href="https://peps.python.org/pep-0647/"><code>PEP 647</code></a>).</p>
<p>类型保护是程序影响类型检查器基于运行时检查所采用的条件类型缩小的一种方式。</p>
<p>基本上，<code>TypeGuard</code>是<code>bool</code>类型的“智能(smart)”别名。 让我们看一下常规的<code>bool</code>示例：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_str_list</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
<span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;判断列表中的所有对象是否都是字符串&quot;&quot;&quot;</span>
<span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func1</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_str_list(val):
        reveal_type(val)  <span style="color: #3D7B7B; font-style: italic"># Reveals list[object]</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot; &quot;</span><span style="color: #666666">.</span>join(val)) <span style="color: #3D7B7B; font-style: italic"># Error: incompatible type</span>
</code></pre></div>
<p>与<code>TypeGuard</code>相同的示例:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for Python 3.9 and below</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_str_list</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;判断列表中的所有对象是否都是字符串&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func1</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_str_list(val):
        reveal_type(val)  <span style="color: #3D7B7B; font-style: italic"># list[str]</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot; &quot;</span><span style="color: #666666">.</span>join(val)) <span style="color: #3D7B7B; font-style: italic"># ok</span>
</code></pre></div>
<p>它是如何工作的？ <code>TypeGuard</code> 将第一个函数参数 (<code>val</code>) 缩小为指定为第一个类型参数 (<code>list[str]</code>) 的类型。</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>缩小范围<a href="https://www.python.org/dev/peps/pep-0647/#enforcing-strict-narrowing">不严格(not strict)</a>。 例如，您可以将<code>str</code>缩小为<code>int</code>：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(value: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">int</span>]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
</code></pre></div>
<p>注意: 由于不强制执行严格的缩小，因此很容易破坏类型安全。</p>
<p>然而，坚定或不知情的开发人员可以通过多种方式破坏类型安全——最常见的是使用强制转换或 Any。 如果 Python 开发人员花时间在代码中学习和实现用户定义的类型保护，则可以安全地假设他们对类型安全感兴趣，并且不会以破坏类型安全或破坏类型安全的方式编写类型保护函数。 产生无意义的结果。</p>
</div>
</div>
<div class="tabbed-block">
<p>Mypy supports User-Defined Type Guards (<a href="https://peps.python.org/pep-0647/"><code>PEP 647</code></a>).</p>
<p>A type guard is a way for programs to influence conditional type narrowing employed by a type checker based on runtime checks.</p>
<p>Basically, a <code>TypeGuard</code> is a "smart" alias for a <code>bool</code> type. Let's have a look at the regular <code>bool</code> example:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_str_list</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000">bool</span>:
<span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Determines whether all objects in the list are strings&quot;&quot;&quot;</span>
<span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func1</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_str_list(val):
        reveal_type(val)  <span style="color: #3D7B7B; font-style: italic"># Reveals list[object]</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot; &quot;</span><span style="color: #666666">.</span>join(val)) <span style="color: #3D7B7B; font-style: italic"># Error: incompatible type</span>
</code></pre></div>
<p>The same example with <code>TypeGuard</code>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for Python 3.9 and below</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_str_list</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">list</span>[<span style="color: #008000">str</span>]]:
<span style="color: #bbbbbb">    </span><span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Determines whether all objects in the list are strings&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">str</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func1</span>(val: <span style="color: #008000">list</span>[<span style="color: #008000">object</span>]) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_str_list(val):
        reveal_type(val)  <span style="color: #3D7B7B; font-style: italic"># list[str]</span>
        <span style="color: #008000">print</span>(<span style="color: #BA2121">&quot; &quot;</span><span style="color: #666666">.</span>join(val)) <span style="color: #3D7B7B; font-style: italic"># ok</span>
</code></pre></div>
<p>How does it work? <code>TypeGuard</code> narrows the first function argument (<code>val</code>) to the type specified as the first type parameter (<code>list[str]</code>).</p>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Narrowing is <a href="https://www.python.org/dev/peps/pep-0647/#enforcing-strict-narrowing">not strict</a>. For example, you can narrow <code>str</code> to <code>int</code>:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(value: <span style="color: #008000">str</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">int</span>]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">True</span>
</code></pre></div>
<p>Note: since strict narrowing is not enforced, it's easy to break type safety.</p>
<p>However, there are many ways a determined or uninformed developer can subvert type safety -- most commonly by using cast or Any. If a Python developer takes the time to learn about and implement user-defined type guards within their code, it is safe to assume that they are interested in type safety and will not write their type guard functions in a way that will undermine type safety or produce nonsensical results.</p>
</div>
</div>
</div>
</div>
<h3 id="泛型类型保护">泛型类型保护<a class="headerlink" href="#泛型类型保护" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">中文</label><label for="__tabbed_7_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><code>TypeGuard</code> 也可以使用泛型类型：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeVar
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

_T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&quot;_T&quot;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_two_element_tuple</span>(val: <span style="color: #008000">tuple</span>[_T, <span style="color: #666666">...</span>]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">tuple</span>[_T, _T]]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">len</span>(val) <span style="color: #666666">==</span> <span style="color: #666666">2</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(names: <span style="color: #008000">tuple</span>[<span style="color: #008000">str</span>, <span style="color: #666666">...</span>]):
    <span style="color: #008000; font-weight: bold">if</span> is_two_element_tuple(names):
        reveal_type(names)  <span style="color: #3D7B7B; font-style: italic"># tuple[str, str]</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        reveal_type(names)  <span style="color: #3D7B7B; font-style: italic"># tuple[str, ...]</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p><code>TypeGuard</code> can also work with generic types:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeVar
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

_T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&quot;_T&quot;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_two_element_tuple</span>(val: <span style="color: #008000">tuple</span>[_T, <span style="color: #666666">...</span>]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">tuple</span>[_T, _T]]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">len</span>(val) <span style="color: #666666">==</span> <span style="color: #666666">2</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(names: <span style="color: #008000">tuple</span>[<span style="color: #008000">str</span>, <span style="color: #666666">...</span>]):
    <span style="color: #008000; font-weight: bold">if</span> is_two_element_tuple(names):
        reveal_type(names)  <span style="color: #3D7B7B; font-style: italic"># tuple[str, str]</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        reveal_type(names)  <span style="color: #3D7B7B; font-style: italic"># tuple[str, ...]</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="带参数的类型保护">带参数的类型保护<a class="headerlink" href="#带参数的类型保护" title="Permanent link">&para;</a></h3>
<p>Typeguards with parameters</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">中文</label><label for="__tabbed_8_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>类型保护函数可以接受额外的参数：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Type, TypeVar
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

_T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&quot;_T&quot;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_set_of</span>(val: <span style="color: #008000">set</span>[Any], <span style="color: #008000">type</span>: Type[_T]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">set</span>[_T]]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">type</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

items: <span style="color: #008000">set</span>[Any]
<span style="color: #008000; font-weight: bold">if</span> is_set_of(items, <span style="color: #008000">str</span>):
    reveal_type(items)  <span style="color: #3D7B7B; font-style: italic"># set[str]</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Type guard functions can accept extra arguments:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> Type, TypeVar
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

_T <span style="color: #666666">=</span> TypeVar(<span style="color: #BA2121">&quot;_T&quot;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_set_of</span>(val: <span style="color: #008000">set</span>[Any], <span style="color: #008000">type</span>: Type[_T]) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">set</span>[_T]]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">all</span>(<span style="color: #008000">isinstance</span>(x, <span style="color: #008000">type</span>) <span style="color: #008000; font-weight: bold">for</span> x <span style="color: #AA22FF; font-weight: bold">in</span> val)

items: <span style="color: #008000">set</span>[Any]
<span style="color: #008000; font-weight: bold">if</span> is_set_of(items, <span style="color: #008000">str</span>):
    reveal_type(items)  <span style="color: #3D7B7B; font-style: italic"># set[str]</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="作为方法的类型保护">作为方法的类型保护<a class="headerlink" href="#作为方法的类型保护" title="Permanent link">&para;</a></h3>
<p>TypeGuards as methods</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">中文</label><label for="__tabbed_9_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<blockquote>
<p>方法也可以充当<code>TypeGuard</code>：</p>
</blockquote>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">StrValidator</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_valid</span>(<span style="color: #008000">self</span>, instance: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">str</span>]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(instance, <span style="color: #008000">str</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(to_validate: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> StrValidator()<span style="color: #666666">.</span>is_valid(to_validate):
        reveal_type(to_validate)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;builtins.str&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>请注意，<code>TypeGuard</code><a href="https://www.python.org/dev/peps/pep-0647/#narrowing-of-implicit-self-and-cls-parameters">不会缩小</a><code>self</code>的类型 或<code>cls</code>隐式参数。</p>
<p>如果需要缩小<code>self</code>或<code>cls</code>，则可以将该值作为显式参数传递给类型保护函数：</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Parent</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">method</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        reveal_type(<span style="color: #008000">self</span>)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Parent&quot;</span>
        <span style="color: #008000; font-weight: bold">if</span> is_child(<span style="color: #008000">self</span>):
            reveal_type(<span style="color: #008000">self</span>)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Child&quot;</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Child</span>(Parent):
    <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_child</span>(instance: Parent) <span style="color: #666666">-&gt;</span> TypeGuard[Child]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(instance, Child)
</code></pre></div>
</div>
</div>
<div class="tabbed-block">
<blockquote>
<p>A method can also serve as the <code>TypeGuard</code>:</p>
</blockquote>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">StrValidator</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_valid</span>(<span style="color: #008000">self</span>, instance: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">str</span>]:
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(instance, <span style="color: #008000">str</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">func</span>(to_validate: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> StrValidator()<span style="color: #666666">.</span>is_valid(to_validate):
        reveal_type(to_validate)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;builtins.str&quot;</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>Note, that <code>TypeGuard</code> <a href="https://www.python.org/dev/peps/pep-0647/#narrowing-of-implicit-self-and-cls-parameters">does not narrow</a> types of <code>self</code> or <code>cls</code> implicit arguments.</p>
<p>If narrowing of <code>self</code> or <code>cls</code> is required, the value can be passed as an explicit argument to a type guard function:</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Parent</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">method</span>(<span style="color: #008000">self</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
        reveal_type(<span style="color: #008000">self</span>)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Parent&quot;</span>
        <span style="color: #008000; font-weight: bold">if</span> is_child(<span style="color: #008000">self</span>):
            reveal_type(<span style="color: #008000">self</span>)  <span style="color: #3D7B7B; font-style: italic"># Revealed type is &quot;Child&quot;</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Child</span>(Parent):
    <span style="color: #666666">...</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_child</span>(instance: Parent) <span style="color: #666666">-&gt;</span> TypeGuard[Child]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(instance, Child)
</code></pre></div>
</div>
</div>
</div>
</div>
<h3 id="作为类型保护的赋值表达式">作为类型保护的赋值表达式<a class="headerlink" href="#作为类型保护的赋值表达式" title="Permanent link">&para;</a></h3>
<p>Assignment expressions as TypeGuards</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">中文</label><label for="__tabbed_10_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>有时您可能需要创建一个新变量并同时将其缩小为某种特定类型。 这可以通过将<code>TypeGuard</code>与 <a href="https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions">:= 运算符</a> 一起使用来实现。</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_float</span>(a: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">float</span>]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(a, <span style="color: #008000">float</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>(a: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_float(x <span style="color: #666666">:=</span> a):
        reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.float&#39;</span>
        reveal_type(a)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
    reveal_type(a)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
</code></pre></div>
<p>这里会发生什么？</p>
<ol>
<li>我们创建一个新变量<code>x</code>并为其分配值<code>a</code></li>
<li>我们在<code>x</code>上运行<code>is_float()</code>类型保护</li>
<li>它将<code>x</code>缩小为<code>if</code>上下文中的<code>float</code>，并且不涉及<code>a</code></li>
</ol>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>这同样适用于<code>isinstance(x := a, float)</code>。</p>
</div>
</div>
<div class="tabbed-block">
<p>Sometimes you might need to create a new variable and narrow it to some specific type at the same time. This can be achieved by using <code>TypeGuard</code> together with <a href="https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions">:= operator</a>.</p>
<div class="language-python highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">typing</span> <span style="color: #008000; font-weight: bold">import</span> TypeGuard  <span style="color: #3D7B7B; font-style: italic"># use `typing_extensions` for `python&lt;3.10`</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_float</span>(a: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> TypeGuard[<span style="color: #008000">float</span>]:
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">isinstance</span>(a, <span style="color: #008000">float</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>(a: <span style="color: #008000">object</span>) <span style="color: #666666">-&gt;</span> <span style="color: #008000; font-weight: bold">None</span>:
    <span style="color: #008000; font-weight: bold">if</span> is_float(x <span style="color: #666666">:=</span> a):
        reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.float&#39;</span>
        reveal_type(a)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
    reveal_type(x)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
    reveal_type(a)  <span style="color: #3D7B7B; font-style: italic"># N: Revealed type is &#39;builtins.object&#39;</span>
</code></pre></div>
<p>What happens here?</p>
<ol>
<li>We create a new variable <code>x</code> and assign a value of <code>a</code> to it</li>
<li>We run <code>is_float()</code> type guard on <code>x</code></li>
<li>It narrows <code>x</code> to be <code>float</code> in the <code>if</code> context and does not touch <code>a</code></li>
</ol>
<div class="admonition info">
<p class="admonition-title">Note</p>
<p>The same will work with <code>isinstance(x := a, float)</code> as well.</p>
</div>
</div>
</div>
</div>

  <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月4日</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "content.tabs.link", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.prune", "navigation.instant"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>