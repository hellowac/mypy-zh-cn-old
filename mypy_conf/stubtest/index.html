
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="hellowac-类型检查">
      
      
      
      
        <link rel="prev" href="../stubgen/">
      
      
        <link rel="next" href="../../mypy_other/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>自动存根测试 - mypy静态类型检查器</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#自动存根测试-stubtest" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
你当前浏览的版本已不是最新版本，
<a href="../../..">
    <strong>点击这里</strong>
</a>查看最新版本的文档

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="mypy静态类型检查器" class="md-header__button md-logo" aria-label="mypy静态类型检查器" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mypy静态类型检查器
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              自动存根测试
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  欢迎来到mypy文档!

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy/" class="md-tabs__link">
          
  
    
  
  第一步

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy/builtin_types/" class="md-tabs__link">
          
  
    
  
  类型系统参考

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  配置和运行mypy

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mypy_other/" class="md-tabs__link">
          
  
    
  
  其他杂项

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../mypy_other/project_links/" class="md-tabs__link">
        
  
    
  
  项目链接

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="mypy静态类型检查器" class="md-nav__button md-logo" aria-label="mypy静态类型检查器" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    mypy静态类型检查器
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/mypy-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hellowac/myppy-zh-cn
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    欢迎来到mypy文档!
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../mypy/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    第一步
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../mypy/builtin_types/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    类型系统参考
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    配置和运行mypy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            配置和运行mypy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../running_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    运行mypy和管理导入
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../command_line/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy命令行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy配置文件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inline_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内联配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mypy_daemon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mypy服务(守护进程)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installed_packages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用安装包
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending_mypy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    扩展和集成 mypy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stubgen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自动存根生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    自动存根测试
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    自动存根测试
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stubtest-能做什么和不能做什么" class="md-nav__link">
    <span class="md-ellipsis">
      stubtest 能做什么和不能做什么
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#示例" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用方法" class="md-nav__link">
    <span class="md-ellipsis">
      使用方法
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../mypy_other/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    其他杂项
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mypy_other/project_links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    项目链接
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#stubtest-能做什么和不能做什么" class="md-nav__link">
    <span class="md-ellipsis">
      stubtest 能做什么和不能做什么
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#示例" class="md-nav__link">
    <span class="md-ellipsis">
      示例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用方法" class="md-nav__link">
    <span class="md-ellipsis">
      使用方法
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="自动存根测试-stubtest">自动存根测试 (stubtest)<a class="headerlink" href="#自动存根测试-stubtest" title="Permanent link">&para;</a></h1>
<p><strong>Automatic stub testing (stubtest)</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>存根文件是包含类型注释的文件。有关更多动机和细节，请参见 <a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP 484</a>。</p>
<p>存根文件的一个常见问题是，它们往往与实际实现有所偏离。Mypy 包含了 <code>stubtest</code> 工具，可以在运行时自动检查存根与实现之间的差异。</p>
</div>
<div class="tabbed-block">
<p>Stub files are files containing type annotations. See <a href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP 484</a> for more motivation and details.</p>
<p>A common problem with stub files is that they tend to diverge from the actual implementation. Mypy includes the <code>stubtest</code> tool that can automatically check for discrepancies between the stubs and the implementation at runtime.</p>
</div>
</div>
</div>
<h2 id="stubtest-能做什么和不能做什么">stubtest 能做什么和不能做什么<a class="headerlink" href="#stubtest-能做什么和不能做什么" title="Permanent link">&para;</a></h2>
<p><strong>What stubtest does and does not do</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><code>stubtest</code> 将导入你的代码并在运行时通过使用 <a href="https://docs.python.org/3/library/inspect.html#module-inspect">inspect</a> 模块的功能来进行对象检查。然后，<code>stubtest</code> 将分析存根文件，并将两者进行比较，指出存根与实际实现之间的差异。</p>
<p>需要注意的是，这种比较有其局限性。<code>stubtest</code> 不会尝试静态分析你的实际代码，而仅依赖动态运行时检查（特别是这种方法意味着 <code>stubtest</code> 对扩展模块的工作效果良好）。然而，这也意味着 <code>stubtest</code> 的可见性有限；例如，它无法判断函数的返回类型在存根中是否被准确地标注。</p>
<p>为了明确，以下是一些 <code>stubtest</code> 无法做到的事情：</p>
<ul>
<li>对你的代码进行类型检查 — 使用 <code>mypy</code> 替代</li>
<li>生成存根 — 使用 <code>stubgen</code> 或 <code>pyright --createstub</code> 替代</li>
<li>基于运行你的应用程序或测试套件生成存根 — 使用 <code>monkeytype</code> 替代</li>
<li>将存根应用到代码中生成内联类型 — 使用 <code>retype</code> 或 <code>libcst</code> 替代</li>
</ul>
<p>总的来说，<code>stubtest</code> 非常适合确保存根与实现之间的基本一致性或检查存根的完整性。它被用来测试 Python 官方的库存根集合 <a href="https://github.com/python/typeshed">typeshed</a>。</p>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p><code>stubtest</code> 会导入并执行它检查的包中的 Python 代码。</p>
</div>
</div>
<div class="tabbed-block">
<p>Stubtest will import your code and introspect your code objects at runtime, for example, by using the capabilities of the <a href="https://docs.python.org/3/library/inspect.html#module-inspect">inspect</a> module. Stubtest will then analyse the stub files, and compare the two, pointing out things that differ between stubs and the implementation at runtime.</p>
<p>It's important to be aware of the limitations of this comparison. Stubtest will not make any attempt to statically analyse your actual code and relies only on dynamic runtime introspection (in particular, this approach means stubtest works well with extension modules). However, this means that stubtest has limited visibility; for instance, it cannot tell if a return type of a function is accurately typed in the stubs.</p>
<p>For clarity, here are some additional things stubtest can't do:</p>
<ul>
<li>Type check your code -- use <code>mypy</code> instead</li>
<li>Generate stubs -- use <code>stubgen</code> or <code>pyright --createstub</code> instead</li>
<li>Generate stubs based on running your application or test suite -- use <code>monkeytype</code> instead</li>
<li>Apply stubs to code to produce inline types -- use <code>retype</code> or <code>libcst</code> instead</li>
</ul>
<p>In summary, stubtest works very well for ensuring basic consistency between stubs and implementation or to check for stub completeness. It's used to test Python's official collection of library stubs, <a href="https://github.com/python/typeshed">typeshed</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>stubtest will import and execute Python code from the packages it checks.</p>
</div>
</div>
</div>
</div>
<h2 id="示例">示例<a class="headerlink" href="#示例" title="Permanent link">&para;</a></h2>
<p><strong>Example</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>以下是 <code>stubtest</code> 可以做的一个快速示例：</p>
<div class="language-shell highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #bbbbbb"> </span>python3<span style="color: #bbbbbb"> </span>-m<span style="color: #bbbbbb"> </span>pip<span style="color: #bbbbbb"> </span>install<span style="color: #bbbbbb"> </span>mypy

$<span style="color: #bbbbbb"> </span>cat<span style="color: #bbbbbb"> </span>library.py
<span style="color: #19177C">x</span><span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot;hello, stubtest&quot;</span>

def<span style="color: #bbbbbb"> </span>foo<span style="color: #666666">(</span><span style="color: #19177C">x</span><span style="color: #666666">=</span>None<span style="color: #666666">)</span>:
<span style="color: #bbbbbb">    </span>print<span style="color: #666666">(</span>x<span style="color: #666666">)</span>

$<span style="color: #bbbbbb"> </span>cat<span style="color: #bbbbbb"> </span>library.pyi
x:<span style="color: #bbbbbb"> </span>int

def<span style="color: #bbbbbb"> </span>foo<span style="color: #666666">(</span>x:<span style="color: #bbbbbb"> </span>int<span style="color: #666666">)</span><span style="color: #bbbbbb"> </span>-&gt;<span style="color: #bbbbbb"> </span>None:<span style="color: #bbbbbb"> </span>...

$<span style="color: #bbbbbb"> </span>python3<span style="color: #bbbbbb"> </span>-m<span style="color: #bbbbbb"> </span>mypy.stubtest<span style="color: #bbbbbb"> </span>library
error:<span style="color: #bbbbbb"> </span>library.foo<span style="color: #bbbbbb"> </span>与运行时不一致，运行时参数<span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot;x&quot;</span><span style="color: #bbbbbb"> </span>有默认值，但存根中的参数没有
存根:<span style="color: #bbbbbb"> </span>第<span style="color: #bbbbbb"> </span><span style="color: #666666">3</span><span style="color: #bbbbbb"> </span>行
def<span style="color: #bbbbbb"> </span><span style="color: #666666">(</span>x:<span style="color: #bbbbbb"> </span>builtins.int<span style="color: #666666">)</span>
运行时:<span style="color: #bbbbbb"> </span>在文件<span style="color: #bbbbbb"> </span>~/library.py:3
def<span style="color: #bbbbbb"> </span><span style="color: #666666">(</span><span style="color: #19177C">x</span><span style="color: #666666">=</span>None<span style="color: #666666">)</span>

error:<span style="color: #bbbbbb"> </span>library.x<span style="color: #bbbbbb"> </span>变量与运行时类型<span style="color: #bbbbbb"> </span>Literal<span style="color: #666666">[</span><span style="color: #BA2121">&#39;hello, stubtest&#39;</span><span style="color: #666666">]</span><span style="color: #bbbbbb"> </span>不一致
存根:<span style="color: #bbbbbb"> </span>第<span style="color: #bbbbbb"> </span><span style="color: #666666">1</span><span style="color: #bbbbbb"> </span>行
builtins.int
运行时:
<span style="color: #BA2121">&#39;hello, stubtest&#39;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>Here's a quick example of what stubtest can do:</p>
<div class="language-shell highlight" style="background: #f8f8f8"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #bbbbbb"> </span>python3<span style="color: #bbbbbb"> </span>-m<span style="color: #bbbbbb"> </span>pip<span style="color: #bbbbbb"> </span>install<span style="color: #bbbbbb"> </span>mypy

$<span style="color: #bbbbbb"> </span>cat<span style="color: #bbbbbb"> </span>library.py
<span style="color: #19177C">x</span><span style="color: #bbbbbb"> </span><span style="color: #666666">=</span><span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot;hello, stubtest&quot;</span>

def<span style="color: #bbbbbb"> </span>foo<span style="color: #666666">(</span><span style="color: #19177C">x</span><span style="color: #666666">=</span>None<span style="color: #666666">)</span>:
<span style="color: #bbbbbb">    </span>print<span style="color: #666666">(</span>x<span style="color: #666666">)</span>

$<span style="color: #bbbbbb"> </span>cat<span style="color: #bbbbbb"> </span>library.pyi
x:<span style="color: #bbbbbb"> </span>int

def<span style="color: #bbbbbb"> </span>foo<span style="color: #666666">(</span>x:<span style="color: #bbbbbb"> </span>int<span style="color: #666666">)</span><span style="color: #bbbbbb"> </span>-&gt;<span style="color: #bbbbbb"> </span>None:<span style="color: #bbbbbb"> </span>...

$<span style="color: #bbbbbb"> </span>python3<span style="color: #bbbbbb"> </span>-m<span style="color: #bbbbbb"> </span>mypy.stubtest<span style="color: #bbbbbb"> </span>library
error:<span style="color: #bbbbbb"> </span>library.foo<span style="color: #bbbbbb"> </span>is<span style="color: #bbbbbb"> </span>inconsistent,<span style="color: #bbbbbb"> </span>runtime<span style="color: #bbbbbb"> </span>argument<span style="color: #bbbbbb"> </span><span style="color: #BA2121">&quot;x&quot;</span><span style="color: #bbbbbb"> </span>has<span style="color: #bbbbbb"> </span>a<span style="color: #bbbbbb"> </span>default<span style="color: #bbbbbb"> </span>value<span style="color: #bbbbbb"> </span>but<span style="color: #bbbbbb"> </span>stub<span style="color: #bbbbbb"> </span>argument<span style="color: #bbbbbb"> </span>does<span style="color: #bbbbbb"> </span>not
Stub:<span style="color: #bbbbbb"> </span>at<span style="color: #bbbbbb"> </span>line<span style="color: #bbbbbb"> </span><span style="color: #666666">3</span>
def<span style="color: #bbbbbb"> </span><span style="color: #666666">(</span>x:<span style="color: #bbbbbb"> </span>builtins.int<span style="color: #666666">)</span>
Runtime:<span style="color: #bbbbbb"> </span><span style="color: #008000; font-weight: bold">in</span><span style="color: #bbbbbb"> </span>file<span style="color: #bbbbbb"> </span>~/library.py:3
def<span style="color: #bbbbbb"> </span><span style="color: #666666">(</span><span style="color: #19177C">x</span><span style="color: #666666">=</span>None<span style="color: #666666">)</span>

error:<span style="color: #bbbbbb"> </span>library.x<span style="color: #bbbbbb"> </span>variable<span style="color: #bbbbbb"> </span>differs<span style="color: #bbbbbb"> </span>from<span style="color: #bbbbbb"> </span>runtime<span style="color: #bbbbbb"> </span><span style="color: #008000">type</span><span style="color: #bbbbbb"> </span>Literal<span style="color: #666666">[</span><span style="color: #BA2121">&#39;hello, stubtest&#39;</span><span style="color: #666666">]</span>
Stub:<span style="color: #bbbbbb"> </span>at<span style="color: #bbbbbb"> </span>line<span style="color: #bbbbbb"> </span><span style="color: #666666">1</span>
builtins.int
Runtime:
<span style="color: #BA2121">&#39;hello, stubtest&#39;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="使用方法">使用方法<a class="headerlink" href="#使用方法" title="Permanent link">&para;</a></h2>
<p><strong>Usage</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>运行 <code>stubtest</code> 可以简单地通过 <code>stubtest module_to_check</code> 来完成。运行 <code>stubtest --help</code> 可以获取选项的简要说明。</p>
<p><code>stubtest</code> 需要能够导入要检查的代码，因此请确保 <code>mypy</code> 已安装在与要测试的库相同的环境中。在某些情况下，设置 <code>PYTHONPATH</code> 可以帮助 <code>stubtest</code> 找到要导入的代码。</p>
<p>类似地，<code>stubtest</code> 也需要能够找到要检查的存根文件。<code>stubtest</code> 会尊重 <code>MYPYPATH</code> 环境变量——如果遇到“未能找到存根”之类的错误，可以考虑使用这个变量。</p>
<p>请注意，<code>stubtest</code> 需要 <code>mypy</code> 能够分析存根。如果 <code>mypy</code> 无法分析存根，可能会出现“由于 mypy 构建错误未检查存根”之类的错误。在这种情况下，需要解决这些错误才能运行 <code>stubtest</code>。尽管这里可能存在错误的重叠，但 <code>stubtest</code> 并不打算替代直接运行 <code>mypy</code>。</p>
<p>如果希望忽略一些 <code>stubtest</code> 的警告，<code>stubtest</code> 支持一个相当有用的允许列表系统。</p>
<p>本节其余部分描述了 <code>stubtest</code> 的命令行接口。</p>
<dl>
<dt><span id="concise"></span><code>--concise</code></dt>
<dd>
<p>使 <code>stubtest</code> 的输出更简洁，每个错误一行</p>
</dd>
<dt><span id="ignore-missing-stub"></span><code>--ignore-missing-stub</code></dt>
<dd>
<p>忽略存根缺少运行时存在的内容的错误</p>
</dd>
<dt><span id="ignore-positional-only"></span><code>--ignore-positional-only</code></dt>
<dd>
<p>忽略参数是否应为位置参数的错误</p>
</dd>
<dt><span id="allowlist"></span><code>--allowlist FILE</code></dt>
<dd>
<p>使用文件作为允许列表。可以多次传递以组合多个允许列表。允许列表可以使用 <code>--generate-allowlist</code> 创建。允许列表支持正则表达式。</p>
<p>允许列表中的条目表示 <code>stubtest</code> 不会对对应的定义生成任何错误。</p>
</dd>
<dt><span id="generate-allowlist"></span><code>--generate-allowlist</code></dt>
<dd>
<p>打印允许列表（到标准输出），以便与 <code>--allowlist</code> 一起使用</p>
<p>当将 <code>stubtest</code> 引入现有项目时，这是消除所有现有错误的简单方法。</p>
</dd>
<dt><span id="ignore-unused-allowlist"></span><code>--ignore-unused-allowlist</code></dt>
<dd>
<p>忽略未使用的允许列表条目</p>
<p>启用此选项之前的默认行为是如果允许列表条目对 <code>stubtest</code> 成功通过没有必要，<code>stubtest</code> 会发出警告。</p>
<p>请注意，如果允许列表条目是匹配空字符串的正则表达式，<code>stubtest</code> 将永远不会将其视为未使用。例如，要为单个允许列表条目如 <code>foo.bar</code> 获取 <code>--ignore-unused-allowlist</code> 行为，可以添加允许列表条目 <code>(foo\.bar)?</code>。这在错误仅在特定平台上出现时可能会很有用。</p>
</dd>
<dt><span id="mypy-config-file"></span><code>--mypy-config-file FILE</code></dt>
<dd>
<p>使用指定的 mypy 配置文件来确定 mypy 插件和 mypy 路径</p>
</dd>
<dt><span id="custom-typeshed-dir"></span><code>--custom-typeshed-dir DIR</code></dt>
<dd>
<p>使用 DIR 中的自定义 typeshed</p>
</dd>
<dt><span id="check-typeshed"></span><code>--check-typeshed</code></dt>
<dd>
<p>检查 typeshed 中的所有标准库模块</p>
</dd>
<dt><span id="help"></span><code>--help</code></dt>
<dd>
<p>显示帮助信息 :-)</p>
</dd>
</dl>
</div>
<div class="tabbed-block">
<p>Running stubtest can be as simple as <code>stubtest module_to_check</code>. Run <a href="#help">stubtest --help</a> for a quick summary of options.</p>
<p>Stubtest must be able to import the code to be checked, so make sure that mypy is installed in the same environment as the library to be tested. In some cases, setting <code>PYTHONPATH</code> can help stubtest find the code to import.</p>
<p>Similarly, stubtest must be able to find the stubs to be checked. Stubtest respects the <code>MYPYPATH</code> environment variable -- consider using this if you receive a complaint along the lines of "failed to find stubs".</p>
<p>Note that stubtest requires mypy to be able to analyse stubs. If mypy is unable to analyse stubs, you may get an error on the lines of "not checking stubs due to mypy build errors". In this case, you will need to mitigate those errors before stubtest will run. Despite potential overlap in errors here, stubtest is not intended as a substitute for running mypy directly.</p>
<p>If you wish to ignore some of stubtest's complaints, stubtest supports a pretty handy allowlist system.</p>
<p>The rest of this section documents the command line interface of stubtest.</p>
<dl>
<dt><span id="concise"></span><code>--concise</code></dt>
<dd>
<p>Makes stubtest's output more concise, one line per error</p>
</dd>
<dt><span id="ignore-missing-stub"></span><code>--ignore-missing-stub</code></dt>
<dd>
<p>Ignore errors for stub missing things that are present at runtime</p>
</dd>
<dt><span id="ignore-positional-only"></span><code>--ignore-positional-only</code></dt>
<dd>
<p>Ignore errors for whether an argument should or shouldn't be positional-only</p>
</dd>
<dt><span id="allowlist"></span><code>--allowlist FILE</code></dt>
<dd>
<p>Use file as an allowlist. Can be passed multiple times to combine multiple allowlists. Allowlists can be created with --generate-allowlist. Allowlists support regular expressions.</p>
<p>The presence of an entry in the allowlist means stubtest will not generate any errors for the corresponding definition.</p>
</dd>
<dt><span id="generate-allowlist"></span><code>--generate-allowlist</code></dt>
<dd>
<p>Print an allowlist (to stdout) to be used with --allowlist</p>
<p>When introducing stubtest to an existing project, this is an easy way to silence all existing errors.</p>
</dd>
<dt><span id="ignore-unused-allowlist"></span><code>--ignore-unused-allowlist</code></dt>
<dd>
<p>Ignore unused allowlist entries</p>
<p>Without this option enabled, the default is for stubtest to complain if an allowlist entry is not necessary for stubtest to pass successfully.</p>
<p>Note if an allowlist entry is a regex that matches the empty string, stubtest will never consider it unused. For example, to get <code>--ignore-unused-allowlist</code> behaviour for a single allowlist entry like <code>foo.bar</code> you could add an allowlist entry <code>(foo\.bar)?</code>. This can be useful when an error only occurs on a specific platform.</p>
</dd>
<dt><span id="mypy-config-file"></span><code>--mypy-config-file FILE</code></dt>
<dd>
<p>Use specified mypy config file to determine mypy plugins and mypy path</p>
</dd>
<dt><span id="custom-typeshed-dir"></span><code>--custom-typeshed-dir DIR</code></dt>
<dd>
<p>Use the custom typeshed in DIR</p>
</dd>
<dt><span id="check-typeshed"></span><code>--check-typeshed</code></dt>
<dd>
<p>Check all stdlib modules in typeshed</p>
</dd>
<dt><span id="help"></span><code>--help</code></dt>
<dd>
<p>Show a help message :-)</p>
</dd>
</dl>
</div>
</div>
</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月16日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年9月13日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "content.tabs.link", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.prune", "navigation.instant"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>